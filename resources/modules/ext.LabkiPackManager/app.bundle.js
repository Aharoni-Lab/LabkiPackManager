var Vue="undefined"!=typeof mw&&mw.loader&&mw.loader.require?mw.loader.require("vue"):window.Vue,Codex="undefined"!=typeof mw&&mw.loader&&mw.loader.require?mw.loader.require("@wikimedia/codex")||mw.loader.require("codex"):window.Codex,mermaid=function(){try{if("undefined"!=typeof window&&window.mermaid)return window.mermaid;if("undefined"!=typeof mw&&mw.loader&&mw.loader.require){var e=mw.loader.require("ext.mermaid");if(e?.initialize)return e;if(e?.mermaid?.initialize)return e.mermaid;if(e?.default?.initialize)return e.default}}catch(e){}return window.mermaid}();!function(e,a){"use strict";const t=e.reactive({repoUrl:"",ref:"",mermaidSrc:"",hierarchy:null,packs:{},stateHash:"",warnings:[],busy:!1,selectedRepo:null,repos:[]});function n(){return new mw.Api}async function o(e){try{return await e()}catch(e){throw console.error("API call failed:",e),e}}async function l(e,a){return o(async()=>{const t=n();console.log("[reposAdd] Sending request:",{repo_url:e,default_ref:a});const o=await t.post({action:"labkiReposAdd",format:"json",repo_url:e,default_ref:a});console.log("[reposAdd] Raw API response:",o),console.log("[reposAdd] Response keys:",Object.keys(o));const l=o.labkiReposAdd||o;return console.log("[reposAdd] Returning data:",l),l})}async function r(e,a){return o(async()=>{const t=n(),o=await t.get({action:"labkiGraphGet",format:"json",repo_url:e,ref:a});console.log("[graphGet] Response:",o);let l=o.labkiGraphGet;if(!l){if(!(o.graph&&o.repo_url&&o.ref))throw new Error("Invalid graphGet response structure");console.log("[graphGet] Using unwrapped response"),l=o}return l})}async function i(e,a){return o(async()=>{const t=n(),o=await t.get({action:"labkiHierarchyGet",format:"json",repo_url:e,ref:a});console.log("[hierarchyGet] Response:",o);let l=o.labkiHierarchyGet;if(!l){if(!(o.hierarchy&&o.repo_url&&o.ref))throw new Error("Invalid hierarchyGet response structure");console.log("[hierarchyGet] Using unwrapped response"),l=o}return l})}async function s(e){return o(async()=>{const a=n();console.log("[packsAction] Sending payload:",e);const t=await a.post({action:"labkiPacksAction",format:"json",payload:JSON.stringify(e)});console.log("[packsAction] Raw response:",t);let o=t.labkiPacksAction;if(!o)throw console.error("[packsAction] Cannot find labkiPacksAction in response:",JSON.stringify(t,null,2)),new Error("Invalid packsAction response structure");return console.log("[packsAction] Returning:",o),o})}async function c(e){return o(async()=>{const a=n(),t=await a.get({action:"labkiOperationsStatus",format:"json",operation_id:e});return console.log("[operationStatus] Raw response:",t),console.log("[operationStatus] Response keys:",Object.keys(t)),console.log("[operationStatus] status field:",t?.status),console.log("[operationStatus] operation_id field:",t?.operation_id),t})}async function d(e,a=60,t=1e3,n){console.log(`[pollOperation] Starting poll for ${e}`);for(let o=0;o<a;o++){const l=await c(e);if(console.log(`[pollOperation] Attempt ${o+1}/${a}, status: ${l.status}, progress: ${l.progress}%, message: ${l.message}`),n&&n(l),"success"===l.status)return console.log("[pollOperation] Operation completed successfully:",l),l;if("failed"===l.status)throw console.error("[pollOperation] Operation failed:",l.message),new Error(`Operation failed: ${l.message}`);o<a-1&&await new Promise(e=>setTimeout(e,t))}throw new Error(`Operation timed out after ${a} attempts`)}const p={class:"add-repo-form"},u={class:"error"};var m={__name:"AddRepoModal",props:{modelValue:Boolean},emits:["update:modelValue","added"],setup(t,{emit:n}){const o=t,r=n,i=e.computed({get:()=>o.modelValue,set:e=>r("update:modelValue",e)}),s=e.ref(""),c=e.ref("main"),m=e.ref(""),f=e.ref(""),g=e.ref(!1),v=e.ref(""),k=e.computed(()=>""!==s.value.trim()&&""!==c.value.trim()&&!m.value);function y(){m.value="";const e=s.value.trim();if(e)try{new URL(e),e.match(/^(https?|git|ssh):\/\//)||(m.value=mw.msg("labkipackmanager-error-invalid-protocol"))}catch{m.value=mw.msg("labkipackmanager-error-invalid-url")}}async function h(){if(k.value&&!g.value){g.value=!0,f.value="";try{const e=s.value.trim(),a=c.value.trim();v.value="Queueing repository initialization...";const t=await l(e,a);console.log("[AddRepoModal] reposAdd response:",t),console.log("[AddRepoModal] operation_id:",t?.operation_id),t?.operation_id?(console.log(`[AddRepoModal] Polling operation ${t.operation_id}...`),await d(t.operation_id,60,1e3,e=>{e.message?v.value=e.message:"queued"===e.status?v.value="Waiting for job to start...":"running"===e.status&&(v.value=`Initializing repository... (${e.progress||0}%)`)}),console.log("[AddRepoModal] Operation completed successfully"),v.value="Repository initialized successfully!"):(console.log("[AddRepoModal] No operation_id, repo may already exist"),v.value="Repository already exists"),r("added",{repoUrl:e,operationId:t?.operation_id||null}),await new Promise(e=>setTimeout(e,500)),b()}catch(e){console.error("[AddRepoModal] Error adding repo:",e),f.value=e instanceof Error?e.message:String(e),v.value=""}finally{g.value=!1}}}function b(){s.value="",c.value="main",m.value="",f.value="",v.value="",i.value=!1}function x(e){return mw.msg(e)}return(t,n)=>(e.openBlock(),e.createBlock(e.unref(a.CdxDialog),{open:i.value,"onUpdate:open":n[2]||(n[2]=e=>i.value=e),title:x("labkipackmanager-add-repo-title"),"primary-action":{label:x("labkipackmanager-add-repo-submit"),actionType:"progressive",disabled:g.value||!k.value},"default-action":{label:x("labkipackmanager-cancel")},onPrimary:h,onDefault:b},{default:e.withCtx(()=>[e.createElementVNode("div",p,[e.createVNode(e.unref(a.CdxField),{"is-fieldset":!1},e.createSlots({label:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(x("labkipackmanager-repo-url-label")),1)]),default:e.withCtx(()=>[e.createVNode(e.unref(a.CdxTextInput),{modelValue:s.value,"onUpdate:modelValue":[n[0]||(n[0]=e=>s.value=e),y],placeholder:x("labkipackmanager-repo-url-placeholder"),disabled:g.value},null,8,["modelValue","placeholder","disabled"])]),_:2},[m.value?{name:"help-text",fn:e.withCtx(()=>[e.createElementVNode("span",u,e.toDisplayString(m.value),1)]),key:"0"}:void 0]),1024),e.createVNode(e.unref(a.CdxField),{"is-fieldset":!1},{label:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(x("labkipackmanager-default-ref-label")),1)]),default:e.withCtx(()=>[e.createVNode(e.unref(a.CdxTextInput),{modelValue:c.value,"onUpdate:modelValue":n[1]||(n[1]=e=>c.value=e),placeholder:x("labkipackmanager-default-ref-placeholder"),disabled:g.value},null,8,["modelValue","placeholder","disabled"])]),_:1}),v.value&&!f.value?(e.openBlock(),e.createBlock(e.unref(a.CdxMessage),{key:0,type:"notice",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(v.value),1)]),_:1})):e.createCommentVNode("v-if",!0),f.value?(e.openBlock(),e.createBlock(e.unref(a.CdxMessage),{key:1,type:"error",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(f.value),1)]),_:1})):e.createCommentVNode("v-if",!0)])]),_:1},8,["open","title","primary-action","default-action"]))},__scopeId:"data-v-0cf6aec2",__file:"resources/src/ui/AddRepoModal.vue"};const f={class:"add-ref-form"},g={class:"repo-info"};var v={__name:"AddRefModal",props:{modelValue:Boolean,repoUrl:String},emits:["update:modelValue","added"],setup(t,{emit:n}){const o=t,r=n,i=e.computed({get:()=>o.modelValue,set:e=>r("update:modelValue",e)}),s=e.ref(""),c=e.ref(""),p=e.ref(!1),u=e.ref(""),m=e.computed(()=>""!==s.value.trim());async function v(){if(m.value&&!p.value){p.value=!0,c.value="";try{const e=s.value.trim();u.value="Queueing ref initialization...";const a=await l(o.repoUrl,e);console.log("[AddRefModal] reposAdd response:",a),console.log("[AddRefModal] Response keys:",Object.keys(a||{})),console.log("[AddRefModal] operation_id:",a?.operation_id),console.log("[AddRefModal] labkiReposAdd:",a?.labkiReposAdd),a?.operation_id?(console.log(`[AddRefModal] Polling operation ${a.operation_id}...`),await d(a.operation_id,60,1e3,e=>{e.message?u.value=e.message:"queued"===e.status?u.value="Waiting for job to start...":"running"===e.status&&(u.value=`Creating worktree... (${e.progress||0}%)`)}),console.log("[AddRefModal] Operation completed successfully"),u.value="Ref initialized successfully!"):(console.log("[AddRefModal] No operation_id, ref may already exist"),u.value="Ref already exists"),r("added",{refName:e,operationId:a?.operation_id||null}),await new Promise(e=>setTimeout(e,500)),k()}catch(e){console.error("[AddRefModal] Error adding ref:",e),c.value=e instanceof Error?e.message:String(e),u.value=""}finally{p.value=!1}}}function k(){s.value="",c.value="",u.value="",i.value=!1}function y(e){return mw.msg(e)}return(n,o)=>(e.openBlock(),e.createBlock(e.unref(a.CdxDialog),{open:i.value,"onUpdate:open":o[1]||(o[1]=e=>i.value=e),title:y("labkipackmanager-add-ref-title"),"primary-action":{label:y("labkipackmanager-add-ref-submit"),actionType:"progressive",disabled:p.value||!m.value},"default-action":{label:y("labkipackmanager-cancel")},onPrimary:v,onDefault:k},{default:e.withCtx(()=>[e.createElementVNode("div",f,[e.createElementVNode("p",g,[e.createElementVNode("strong",null,e.toDisplayString(y("labkipackmanager-repository"))+":",1),e.createTextVNode(" "+e.toDisplayString(t.repoUrl),1)]),e.createVNode(e.unref(a.CdxField),{"is-fieldset":!1},{label:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(y("labkipackmanager-ref-name-label")),1)]),default:e.withCtx(()=>[e.createVNode(e.unref(a.CdxTextInput),{modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=e=>s.value=e),placeholder:y("labkipackmanager-ref-name-placeholder"),disabled:p.value},null,8,["modelValue","placeholder","disabled"])]),_:1}),u.value&&!c.value?(e.openBlock(),e.createBlock(e.unref(a.CdxMessage),{key:0,type:"notice",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(u.value),1)]),_:1})):e.createCommentVNode("v-if",!0),c.value?(e.openBlock(),e.createBlock(e.unref(a.CdxMessage),{key:1,type:"error",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(c.value),1)]),_:1})):e.createCommentVNode("v-if",!0)])]),_:1},8,["open","title","primary-action","default-action"]))},__scopeId:"data-v-f029ab7a",__file:"resources/src/ui/AddRefModal.vue"};const k={class:"repo-ref-selector"},y={class:"selector-row",style:{display:"flex",gap:"24px","flex-wrap":"nowrap"}},h={class:"selector-field",style:{flex:"1 1 0","min-width":"0"}},b={class:"selector-field",style:{flex:"1 1 0","min-width":"0"}},x={key:0,class:"current-selection"},w="__add_new_repo__",N="__add_new_ref__";var S={__name:"RepoRefSelector",setup(l){const c=e.ref(""),d=e.ref(""),p=e.ref(!1),u=e.ref(!1),f=e.ref(""),g=e.computed(()=>{if(console.log("Computing repoMenuItems, store.repos:",t.repos),!t.repos||0===t.repos.length)return[{label:"Loading...",value:"",disabled:!0}];const e=t.repos.map(e=>({label:e.repo_url,value:e.repo_url}));return e.push({label:"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",value:"__separator__",disabled:!0}),e.push({label:D("labkipackmanager-add-repo-option"),value:w}),e}),S=e.computed(()=>{if(!t.selectedRepo)return[];const e=t.selectedRepo.refs.map(e=>({label:`${e.ref_name} ${e.is_default?"(default)":""}`,value:e.ref}));return e.push({label:"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",value:"__separator__",disabled:!0}),e.push({label:D("labkipackmanager-add-ref-option"),value:N}),e});async function V(){try{console.log("[loadRepos] Starting..."),t.busy=!0,f.value="",console.log("[loadRepos] Calling reposList API...");const e=await async function(){return o(async()=>{console.log("[reposList] Starting API call...");const e=n();console.log("[reposList] API instance:",e);const a=await e.get({action:"labkiReposList",format:"json"});if(console.log("[reposList] Raw API response:",a),console.log("[reposList] Response keys:",Object.keys(a)),!a)throw new Error("No response from API");let t=a.labkiReposList;if(!t){if(!a.repos||!a.meta)throw console.error("[reposList] Cannot find repos data in response:",JSON.stringify(a,null,2)),new Error("Invalid API response structure - no labkiReposList field and no repos field");console.log("[reposList] Response appears to be unwrapped, using directly"),t=a}return console.log("[reposList] Data structure:",t),console.log("[reposList] Returning:",t),t})}();if(console.log("[loadRepos] API response received:",e),!e)throw new Error("No response from reposList API");if(!e.repos)throw new Error("Invalid response structure - no repos field. Response: "+JSON.stringify(e));console.log("[loadRepos] Setting store.repos:",e.repos),t.repos=e.repos,console.log("[loadRepos] store.repos is now:",t.repos),console.log("[loadRepos] store.repos.length:",t.repos.length),t.repos.length>0&&!c.value&&(console.log("[loadRepos] Auto-selecting first repo:",t.repos[0].repo_url),await _(t.repos[0].repo_url))}catch(e){console.error("[loadRepos] Error:",e),f.value=e instanceof Error?e.message:String(e)}finally{t.busy=!1,console.log("[loadRepos] Finished. store.busy:",t.busy,"store.repos:",t.repos)}}async function E(e){if(e===w)return p.value=!0,void(c.value=t.repoUrl);"string"==typeof e&&e&&"__separator__"!==e&&await _(e)}async function _(e){try{t.busy=!0,f.value="",c.value=e,t.repoUrl=e;const a=t.repos.find(a=>a.repo_url===e);if(!a)throw new Error(D("labkipackmanager-error-repo-not-found"));t.selectedRepo=a;const n=a.refs.find(e=>e.is_default),o=n?.ref||a.refs[0]?.ref;o&&await B(o)}catch(e){f.value=e instanceof Error?e.message:String(e)}finally{t.busy=!1}}async function C(e){if(e===N)return u.value=!0,void(d.value=t.ref);"string"==typeof e&&e&&"__separator__"!==e&&await B(e)}async function B(e){try{t.busy=!0,f.value="",d.value=e,t.ref=e,t.packs={},t.warnings=[];const[a,n]=await Promise.all([r(t.repoUrl,t.ref),i(t.repoUrl,t.ref)]);t.mermaidSrc=function(e){const a=["graph TD"],t=new Set,n=[];for(const a of e.containsEdges||[])t.add(a.from),t.add(a.to),n.push({from:a.from,to:a.to,type:"contains"});for(const a of e.dependsEdges||[])t.add(a.from),t.add(a.to),n.push({from:a.from,to:a.to,type:"depends"});for(const e of t){const t=A(e),[n,...o]=e.split(":"),l=o.join(":"),r="page"===n?"ðŸ“„":"ðŸ“¦";a.push(`  ${t}["${r} ${l}"]`)}for(const e of n){const t=A(e.from),n=A(e.to);"depends"===e.type?a.push(`  ${t} -.-> ${n}`):a.push(`  ${t} --\x3e ${n}`)}const o=a.join("\n");return console.log("[buildMermaidFromGraph] Generated Mermaid syntax:\n",o),o}(a.graph),t.hierarchy=n.hierarchy;const o=await s({command:"init",repo_url:t.repoUrl,ref:t.ref,data:{}});t.packs=o.diff,t.stateHash=o.state_hash,t.warnings=o.warnings}catch(e){f.value=e instanceof Error?e.message:String(e)}finally{t.busy=!1}}async function R(e){try{t.busy=!0,f.value="";const{repoUrl:a}=e;console.log(`[onRepoAdded] Repo '${a}' initialized, reloading repos and selecting...`),await V(),await _(a),console.log("[onRepoAdded] Repo selected successfully")}catch(e){console.error("[onRepoAdded] Error:",e),f.value=e instanceof Error?e.message:String(e)}finally{t.busy=!1}}async function T(e){try{t.busy=!0,f.value="";const{refName:a}=e;console.log(`[onRefAdded] Ref '${a}' initialized, reloading repos and selecting...`),await V(),c.value&&await _(c.value),await B(a),console.log("[onRefAdded] Ref selected successfully")}catch(e){console.error("[onRefAdded] Error:",e),f.value=e instanceof Error?e.message:String(e)}finally{t.busy=!1}}function A(e){return e.replace(/[^a-zA-Z0-9_]/g,"_")}function D(e){return mw.msg(e)}return e.onMounted(async()=>{console.log("RepoRefSelector mounted, store:",t),await V()}),(n,o)=>(e.openBlock(),e.createElementBlock("div",k,[e.createElementVNode("h2",null,e.toDisplayString(D("labkipackmanager-select-source")),1),e.createElementVNode("div",y,[e.createElementVNode("div",h,[e.createVNode(e.unref(a.CdxField),null,{label:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(D("labkipackmanager-repo-selector-label")),1)]),default:e.withCtx(()=>[e.createVNode(e.unref(a.CdxSelect),{selected:c.value,"onUpdate:selected":[o[0]||(o[0]=e=>c.value=e),E],"menu-items":g.value,disabled:e.unref(t).busy},null,8,["selected","menu-items","disabled"])]),_:1})]),e.createElementVNode("div",b,[e.createVNode(e.unref(a.CdxField),null,{label:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(D("labkipackmanager-ref-selector-label")),1)]),default:e.withCtx(()=>[e.createVNode(e.unref(a.CdxSelect),{selected:d.value,"onUpdate:selected":[o[1]||(o[1]=e=>d.value=e),C],"menu-items":S.value,disabled:e.unref(t).busy||!c.value},null,8,["selected","menu-items","disabled"])]),_:1})])]),c.value&&d.value?(e.openBlock(),e.createElementBlock("div",x,[e.createElementVNode("strong",null,e.toDisplayString(D("labkipackmanager-current-selection"))+":",1),e.createTextVNode(" "+e.toDisplayString(c.value)+" @ "+e.toDisplayString(d.value),1)])):e.createCommentVNode("v-if",!0),f.value?(e.openBlock(),e.createBlock(e.unref(a.CdxMessage),{key:1,type:"error",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(f.value),1)]),_:1})):e.createCommentVNode("v-if",!0),e.createVNode(m,{modelValue:p.value,"onUpdate:modelValue":o[2]||(o[2]=e=>p.value=e),onAdded:R},null,8,["modelValue"]),e.createVNode(v,{modelValue:u.value,"onUpdate:modelValue":o[3]||(o[3]=e=>u.value=e),"repo-url":c.value,onAdded:T},null,8,["modelValue","repo-url"])]))},__scopeId:"data-v-a9c77630",__file:"resources/src/ui/RepoRefSelector.vue"};const V={class:"mermaid-graph-container"},E={key:0,class:"no-mermaid-message"},_={key:1,class:"mermaid-wrapper"},C={key:2,class:"no-graph-message"};var B={__name:"MermaidGraph",props:{mermaidSrc:String},setup(t){const n=t,o=e.ref(!1),l=e.ref(null);function r(e){return mw.msg(e)}return e.onMounted(()=>{!function(){const e=mw.loader.getState("ext.mermaid");o.value="ready"===e||"loaded"===e||"loading"===e,o.value?console.log("[MermaidGraph] Mermaid extension is available, state:",e):console.warn("Mermaid extension is not available")}()}),e.watch(()=>n.mermaidSrc,async()=>{o.value&&n.mermaidSrc&&(await e.nextTick(),function(){if(console.log("[MermaidGraph] Triggering Mermaid render"),"undefined"!=typeof window&&window.mermaid)try{if("function"==typeof window.mermaid.initialize&&(console.log("[MermaidGraph] Calling mermaid.initialize()"),window.mermaid.initialize({startOnLoad:!1,theme:"forest",securityLevel:"loose"})),l.value){const e=l.value.querySelectorAll("svg");e.forEach(e=>e.remove()),console.log("[MermaidGraph] Removed",e.length,"existing SVG(s)"),l.value.innerHTML=n.mermaidSrc,l.value.removeAttribute("data-processed")}setTimeout(()=>{console.log("[MermaidGraph] Attempting to render mermaid diagrams"),"function"==typeof window.mermaid.run?(window.mermaid.run(),console.log("[MermaidGraph] Called mermaid.run()")):"function"==typeof window.mermaid.contentLoaded&&(window.mermaid.contentLoaded(),console.log("[MermaidGraph] Called mermaid.contentLoaded()"))},100)}catch(e){console.error("[MermaidGraph] Failed to trigger mermaid render:",e)}else console.warn("[MermaidGraph] window.mermaid not available")}())}),(n,i)=>(e.openBlock(),e.createElementBlock("div",V,[e.createElementVNode("h3",null,e.toDisplayString(r("labkipackmanager-graph-title")),1),o.value?t.mermaidSrc?(e.openBlock(),e.createElementBlock("div",_,[e.createElementVNode("pre",{class:"mermaid",ref_key:"mermaidPre",ref:l},e.toDisplayString(t.mermaidSrc),513)])):(e.openBlock(),e.createElementBlock("div",C,[e.createElementVNode("p",null,e.toDisplayString(r("labkipackmanager-no-graph-loaded")),1)])):(e.openBlock(),e.createElementBlock("div",E,[e.createVNode(e.unref(a.CdxMessage),{type:"warning",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(r("labkipackmanager-mermaid-not-installed")),1)]),_:1})]))]))}};function R(e,a){for(const[t,n]of Object.entries(a)){const a=e[t]??{};e[t]=T(a,n)}}function T(e,a){const t={...e,...a};if(a.pages){t.pages={...e.pages??{}};for(const[e,n]of Object.entries(a.pages)){const a=t.pages[e]??{};t.pages[e]=A(a,n)}}return t}function A(e,a){return{...e,...a}}B.__scopeId="data-v-04226ecd",B.__file="resources/src/ui/MermaidGraph.vue";const D=["data-type","data-action","data-installed"],M=["data-depth"],P={class:"pack-content-wrapper",style:{display:"flex",gap:"12px",alignItems:"flex-start"}},I=["aria-expanded","aria-label"],L={key:1,class:"toggle-spacer"},z={class:"name-section"},O=["title"],U={key:0,class:"badge version"},W=["title"],$={key:2,class:"badge update"},F=["value","placeholder","disabled","readonly"],H={key:0,class:"action-item"},G={key:1,class:"action-item"},j={key:2,class:"action-item"},q={key:0,class:"pages-column",style:{flex:"1",minWidth:"250px",maxWidth:"400px",display:"flex",flexDirection:"column",gap:"4px",padding:"6px",background:"rgba(248, 249, 250, 0.3)",borderRadius:"6px",border:"1px solid #eaecf0"}},Y={style:{fontSize:"0.7em",color:"#72777d",fontWeight:"700",textTransform:"uppercase",letterSpacing:"0.5px",marginBottom:"2px",paddingLeft:"4px"}},K=["title"],Q={key:0,class:"page-rename-inline",style:{display:"flex",alignItems:"center",gap:"3px",flex:"1",minWidth:"0"}},J={key:0,class:"prefix-chip-inline",style:{fontSize:"0.7em",padding:"3px 6px",background:"#f0f0f0",border:"1px solid #c8ccd1",borderRight:"none",borderRadius:"3px 0 0 3px",color:"#54595d",whiteSpace:"nowrap",fontFamily:"Monaco, Menlo, Consolas, monospace"}},Z=["value","placeholder","disabled","readonly","onInput","onFocus","aria-invalid"],X=["id","title"],ee={key:0,class:"meta-row",style:{marginTop:"6px",paddingLeft:"32px",paddingTop:"6px",borderTop:"1px solid #eaecf0"}},ae={class:"meta-content",style:{display:"flex",flexDirection:"column",gap:"3px"}},te={key:0,class:"desc",style:{fontSize:"0.85em",color:"#54595d",lineHeight:"1.4"}},ne={key:1,class:"depends",style:{fontSize:"0.8em",color:"#72777d"}},oe={key:0,class:"children",style:{marginTop:"8px",paddingLeft:"16px",borderLeft:"2px solid #eaecf0",paddingTop:"4px"}},le={class:"label"},re={key:0,class:"page-rename-inline"},ie={key:0,class:"prefix-chip-inline"},se=["value","placeholder","disabled","readonly","aria-invalid","aria-describedby"],ce=["id","title"];var de={__name:"TreeNode",props:{node:{type:Object,required:!0},depth:{type:Number,required:!0},parentPackName:{type:String,default:null}},emits:["set-pack-action"],setup(n,{emit:o}){const l=n,r=o,i=e.ref(!1);let c=null,d=null;e.computed(()=>!(!l.node.children||!l.node.children.length));const p=e.computed(()=>"pack"===l.node.type&&t.packs[l.node.label]||null);e.computed(()=>{const e=p.value?.action;return e&&"unchanged"!==e});const u=e.computed(()=>{const e=p.value?.action,a=p.value?.installed;return"install"===e&&!a}),m=e.computed(()=>{const e=p.value?.action,a=p.value?.installed;return"install"===e||"update"===e||a}),f=e.computed(()=>p.value?.prefix||""),g=e.computed(()=>"pack"===l.node.type?l.node.label:null),v=e.computed(()=>"page"===l.node.type&&l.parentPackName||null),k=e.computed(()=>v.value&&t.packs[v.value]||null),y=e.computed(()=>k.value?.pages&&k.value.pages[l.node.label]||null);e.computed(()=>{const e=k.value?.action;return"install"===e||"update"===e});const h=e.computed(()=>{if("pack"===l.node.type){const e=p.value?.action;return"install"===e||"update"===e}const e=k.value?.action,a=y.value?.installed;return"install"===e&&!a}),b=e.computed(()=>{const e=k.value?.action,a=y.value?.installed;return"install"===e||"update"===e||a}),x=e.computed(()=>k.value?.action||"unchanged"),w=e.computed(()=>k.value?.prefix||""),N=e.computed(()=>w.value?w.value.endsWith("/")?w.value:w.value+"/":""),S=e.computed(()=>{const e=y.value?.final_title||"",a=N.value;return a&&e.startsWith(a)?e.slice(a.length):e}),V=e.computed(()=>{const e=y.value?.final_title;return!(!e||!v.value)&&t.warnings.some(a=>a.includes(e)&&a.includes(v.value))}),E=e.computed(()=>{const e=y.value?.final_title;return e&&v.value?t.warnings.filter(a=>a.includes(e)&&a.includes(v.value)).join("\n"):""}),_=e.computed(()=>`collision-${v.value||"none"}-${l.node.label}`),C=e.computed(()=>{const e=p.value;return!!e&&(null!==e.current_version&&(!!e.target_version&&e.target_version>e.current_version))});"pack"===l.node.type&&e.watch(()=>p.value?.action,(e,a)=>{console.log(`[TreeNode:${l.node.label}] packState.action changed: "${a}" -> "${e}"`)});const B=e.computed(()=>{t.stateHash;const e=a=>{if("pack"===a.type){const e=t.packs[a.label];if(e&&e.action&&"unchanged"!==e.action)return!0}if(!a.children)return!1;for(const t of a.children)if(e(t))return!0;return!1};return e(l.node)});function T(){i.value=!i.value}function A(e){const a=p.value?.action,t=a===e?"unchanged":e;console.log(`[TreeNode:${l.node.label}] toggleAction: current="${a}", requested="${e}", next="${t}"`),console.log(`[TreeNode:${l.node.label}] packState:`,p.value),r("set-pack-action",{pack_name:l.node.label,action:t})}function de(){A("install")}function pe(){A("remove")}function ue(){A("update")}function me(e){if(!u.value)return;const a=e.target.value;c&&clearTimeout(c),c=setTimeout(()=>async function(e){if(t.busy)return;try{t.busy=!0;const a=await s({command:"set_pack_prefix",repo_url:t.repoUrl,ref:t.ref,data:{pack_name:l.node.label,prefix:e}});R(t.packs,a.diff),t.stateHash=a.state_hash,t.warnings=a.warnings}catch(e){console.error("set_pack_prefix failed:",e)}finally{t.busy=!1}}(a),400)}function fe(e){if(!h.value)return;const a=e.target.value;d&&clearTimeout(d),d=setTimeout(()=>{!async function(e){if(t.busy||!v.value)return;try{t.busy=!0;const a=await s({command:"rename_page",repo_url:t.repoUrl,ref:t.ref,data:{pack_name:v.value,page_name:l.node.label,new_title:e}});R(t.packs,a.diff),t.stateHash=a.state_hash,t.warnings=a.warnings}catch(e){console.error("rename_page failed:",e)}finally{t.busy=!1}}(N.value?N.value+a:a)},400)}function ge(e){return mw.msg(e)}function ve(e){const a=t.packs[l.node.label];return a?.pages?.[e]||null}function ke(e){const a=ve(e);return a?a.installed?"rgba(232, 240, 248, 0.4)":"install"===p.value?.action?"rgba(232, 245, 233, 0.6)":"remove"===p.value?.action?"rgba(255, 235, 238, 0.6)":"white":"white"}function ye(e){return p.value?.prefix||""}function he(e){const a=ye();return a?a.endsWith("/")?a:a+"/":""}function be(e){const a=ve(e);if(!a)return"";const t=a.final_title||"",n=he();return n&&t.startsWith(n)?t.slice(n.length):t}function xe(e){const a=ve(e),n=a?.final_title;return!(!n||!l.node.label)&&t.warnings.some(e=>e.includes(n)&&e.includes(l.node.label))}function we(e){const a=ve(e),n=a?.final_title;return n&&l.node.label?t.warnings.filter(e=>e.includes(n)&&e.includes(l.node.label)).join("\n"):""}function Ne(e){const a=ve(e);if(!a)return!1;const t=p.value?.action;return"install"===t&&!a.installed||"update"===t}function Se(e,a){const n=p.value?.action;if("install"!==n&&"update"!==n)return void console.log("[onPageTitleChangeForPage] Pack not in install/update mode, ignoring input");const o=ve(a);if(!o)return void console.log("[onPageTitleChangeForPage] No page state found for",a);if("install"===n&&o.installed)return void console.log("[onPageTitleChangeForPage] Page already installed, cannot rename during install");const r=e.target.value;console.log("[onPageTitleChangeForPage] Page:",a,"New value:",r),d&&clearTimeout(d),d=setTimeout(()=>{const e=he(),n=e?e+r:r;console.log("[onPageTitleChangeForPage] Sending rename command. Pack:",l.node.label,"Page:",a,"Title:",n),async function(e,a){if(t.busy)return;try{t.busy=!0;const n=await s({command:"rename_page",repo_url:t.repoUrl,ref:t.ref,data:{pack_name:l.node.label,page_name:e,new_title:a}});R(t.packs,n.diff),t.stateHash=n.state_hash,t.warnings=n.warnings}catch(e){console.error("rename_page failed:",e)}finally{t.busy=!1}}(a,n)},400)}i.value=l.depth<2||B.value,e.onBeforeUnmount(()=>{c&&clearTimeout(c),d&&clearTimeout(d)}),e.computed(()=>{if(!l.node.children)return[];const e=[...l.node.children],a=e=>(e||"").toLocaleLowerCase();return e.sort((e,t)=>{if("page"===e.type&&"page"!==t.type)return-1;if("page"!==e.type&&"page"===t.type)return 1;const n=a(e.label),o=a(t.label);return n<o?-1:n>o?1:0}),e});const Ve=e.computed(()=>l.node.children?l.node.children.filter(e=>"page"===e.type):[]),Ee=e.computed(()=>l.node.children?l.node.children.filter(e=>"pack"===e.type):[]);function _e(e){e.style.height="0",e.style.opacity="0",e.offsetHeight,e.style.transition="height 0.3s ease, opacity 0.3s ease",e.style.height=e.scrollHeight+"px",e.style.opacity="1"}function Ce(e){e.style.height=e.scrollHeight+"px",e.offsetHeight,e.style.transition="height 0.3s ease, opacity 0.3s ease",e.style.height="0",e.style.opacity="0"}return(t,o)=>{const r=e.resolveComponent("tree-node",!0);return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createCommentVNode('\n    ============================================================================\n    TREE NODE LAYOUT - CARD-BASED NESTING WITH INLINE STYLES\n    ============================================================================\n    \n    ðŸŽ¯ CRITICAL SUCCESS FACTORS - WHY THIS WORKS:\n    \n    1. **INLINE STYLES ARE REQUIRED** - CSS classes were NOT working due to:\n       - MediaWiki/Codex CSS has extremely high specificity\n       - External stylesheets were being overridden\n       - Inline styles have highest specificity and can\'t be overridden\n       - âœ… Use :style="" binding in template for all visual styling\n       - âŒ DO NOT rely on CSS classes alone for layout/colors\n    \n    2. **CHILDREN MUST BE INSIDE PACK-CARD** - This creates true nesting:\n       - The .pack-card div wraps the entire pack (row + meta + children)\n       - Children render INSIDE their parent\'s card, not as siblings\n       - This creates the "recursive card nesting" visual effect\n       - Each nested pack gets its own card INSIDE the parent card\n    \n    3. **INDENTATION** - Applied via inline paddingLeft on .node-row:\n       - Formula: `paddingLeft: ${depth * 24}px`\n       - depth=0: 0px, depth=1: 24px, depth=2: 48px, etc.\n       - Applied to .node-row, NOT the .pack-card wrapper\n    \n    4. **COLOR CODING** - Inline background colors based on state:\n       - Installed: #e8f0f8 (blue)\n       - Install action: #e8f5e9 (green)\n       - Remove action: #ffebee (red)\n       - Update action: #fff8e1 (yellow)\n       - Default: #ffffff (white)\n    \n    5. **VISUAL HIERARCHY**:\n       - Border: 2px solid creates clear card boundaries\n       - Border-radius: 8px for rounded corners\n       - Box-shadow: 0 2px 4px rgba() for depth\n       - Padding: 12px inside cards for breathing room\n       - Margin-bottom: 12px between cards\n    \n    âš ï¸ MAINTENANCE NOTES:\n    - If visual changes don\'t appear, check if inline styles are present\n    - CSS classes are kept for semantic purposes but don\'t control layout\n    - Any layout-critical styling MUST be in :style="" bindings\n    - Test changes by checking if inline styles render in browser DevTools\n    \n    ============================================================================\n  '),e.createElementVNode("div",{class:e.normalizeClass(["tree-node",{"is-pack":"pack"===n.node.type,"is-page":"page"===n.node.type}]),"data-type":n.node.type,"data-action":p.value?.action||x.value,"data-installed":"pack"===n.node.type?p.value?.installed:y.value?.installed},[e.createCommentVNode(" \n        PACK CARD WRAPPER - Creates rounded rectangle container\n        âš ï¸ INLINE STYLES REQUIRED: CSS classes don't work due to MW/Codex specificity\n        - Border creates card boundary\n        - Background color shows state: blue=installed, green=install, red=remove, yellow=update\n        - Children render INSIDE this div for proper nesting\n      "),"pack"===n.node.type?(e.openBlock(),e.createElementBlock("div",{key:0,class:"pack-card","data-depth":n.depth,style:e.normalizeStyle({border:"2px solid #c8ccd1",borderRadius:"8px",padding:"10px",marginBottom:"8px",background:p.value?.installed?"#e8f0f8":"install"===p.value?.action?"#e8f5e9":"remove"===p.value?.action?"#ffebee":"update"===p.value?.action?"#fff8e1":"#ffffff",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"})},[e.createCommentVNode(" \n          TWO-COLUMN LAYOUT: Pack info on left, Pages on right\n          âš ï¸ Main content area splits into left (pack) and right (pages)\n        "),e.createElementVNode("div",P,[e.createCommentVNode(" LEFT COLUMN: Pack info and actions "),e.createElementVNode("div",{class:"pack-info-column",style:e.normalizeStyle({flex:Ve.value.length>0?"0 1 auto":"1",minWidth:"0",display:"flex",flexDirection:"column",gap:"8px"})},[e.createCommentVNode(" Pack header row "),e.createElementVNode("div",{class:"node-row",style:e.normalizeStyle({paddingLeft:24*n.depth+"px",display:"flex",alignItems:"center",gap:"8px",flexWrap:"nowrap"})},[e.createCommentVNode(" Toggle arrow "),Ee.value.length>0?(e.openBlock(),e.createElementBlock("button",{key:0,class:"toggle","aria-expanded":i.value.toString(),"aria-label":i.value?ge("labkipackmanager-collapse"):ge("labkipackmanager-expand"),onClick:T},e.toDisplayString(i.value?"â–¼":"â–¶"),9,I)):(e.openBlock(),e.createElementBlock("span",L)),e.createCommentVNode(" Icon "),o[1]||(o[1]=e.createElementVNode("span",{class:"node-icon"},"ðŸ“¦",-1)),e.createCommentVNode(" Name and badges "),e.createElementVNode("span",z,[e.createElementVNode("strong",{class:"label",title:n.node.label},e.toDisplayString(n.node.label),9,O),n.node.version?(e.openBlock(),e.createElementBlock("span",U,"v"+e.toDisplayString(n.node.version),1)):e.createCommentVNode("v-if",!0),p.value&&p.value.action&&"unchanged"!==p.value.action?(e.openBlock(),e.createElementBlock("span",{key:1,class:e.normalizeClass(["badge",p.value.auto_selected_reason?"auto":"manual"]),title:p.value.auto_selected_reason||""},e.toDisplayString(p.value.auto_selected_reason?"Auto":"Manual"),11,W)):e.createCommentVNode("v-if",!0),C.value?(e.openBlock(),e.createElementBlock("span",$,"Update Available")):e.createCommentVNode("v-if",!0)])],4),e.createCommentVNode(" Pack: Inline prefix editor (on second row) "),m.value?(e.openBlock(),e.createElementBlock("div",{key:0,style:e.normalizeStyle({paddingLeft:24*n.depth+32+"px",display:"flex",alignItems:"center",gap:"6px"})},[o[2]||(o[2]=e.createElementVNode("span",{class:"prefix-label",style:{fontSize:"0.75em",color:"#72777d",fontWeight:"600"}},"Prefix:",-1)),e.createElementVNode("input",{class:"prefix-input",type:"text",value:f.value,placeholder:ge("labkipackmanager-pack-prefix-placeholder")||"MyNamespace/MyPack",disabled:!u.value,readonly:!u.value,onInput:me,style:e.normalizeStyle({fontSize:"0.72em",padding:"4px 7px",minWidth:"150px",border:"1px solid #c8ccd1",borderRadius:"3px",background:"white",fontFamily:"Monaco, Menlo, Consolas, monospace",transition:"all 0.15s ease",cursor:u.value?"text":"not-allowed"})},null,44,F)],4)):e.createCommentVNode("v-if",!0),e.createCommentVNode(" Actions (for packs only) - on third row "),e.createElementVNode("div",{class:"actions",style:e.normalizeStyle({paddingLeft:24*n.depth+32+"px",display:"flex",gap:"8px",flexWrap:"wrap"})},[p.value&&null===p.value.current_version?(e.openBlock(),e.createElementBlock("div",H,[e.createVNode(e.unref(a.CdxButton),{action:"progressive",weight:"install"===p.value.action?"primary":"normal",class:e.normalizeClass({active:"install"===p.value.action}),onClick:de},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString("install"===p.value.action?"âœ“ ":"")+e.toDisplayString(ge("labkipackmanager-select")),1)]),_:1},8,["weight","class"])])):e.createCommentVNode("v-if",!0),C.value?(e.openBlock(),e.createElementBlock("div",G,[e.createVNode(e.unref(a.CdxButton),{weight:"update"===p.value?.action?"primary":"normal",class:e.normalizeClass({active:"update"===p.value?.action}),onClick:ue},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString("update"===p.value?.action?"âœ“ ":"")+e.toDisplayString(ge("labkipackmanager-update")),1)]),_:1},8,["weight","class"])])):e.createCommentVNode("v-if",!0),p.value&&null!==p.value.current_version?(e.openBlock(),e.createElementBlock("div",j,[e.createVNode(e.unref(a.CdxButton),{action:"destructive",weight:"remove"===p.value.action?"primary":"normal",class:e.normalizeClass({active:"remove"===p.value.action}),onClick:pe},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString("remove"===p.value.action?"âœ“ ":"")+e.toDisplayString(ge("labkipackmanager-remove")),1)]),_:1},8,["weight","class"])])):e.createCommentVNode("v-if",!0)],4)],4),e.createCommentVNode(" RIGHT COLUMN: Pages list (if any) "),Ve.value.length>0?(e.openBlock(),e.createElementBlock("div",q,[e.createElementVNode("div",Y," ðŸ“„ Pages ("+e.toDisplayString(Ve.value.length)+") ",1),e.createCommentVNode(" Each page as a row with rename input "),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(Ve.value,a=>{return e.openBlock(),e.createElementBlock("div",{key:a.id,class:"page-row-inline",style:e.normalizeStyle({display:"flex",alignItems:"center",gap:"6px",padding:"4px 6px",background:ke(a.label),borderRadius:"4px",border:"1px solid #eaecf0",minHeight:"32px"})},[e.createElementVNode("span",{style:{fontSize:"0.8em",color:"#202122",fontWeight:"500",minWidth:"60px",maxWidth:"80px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:a.label},e.toDisplayString(a.label),9,K),e.createCommentVNode(" Page rename editor (show if pack is selected for install/update or installed) "),m.value?(e.openBlock(),e.createElementBlock("span",Q,[o[3]||(o[3]=e.createElementVNode("span",{class:"arrow",style:{color:"#72777d",fontSize:"0.8em"}},"â†’",-1)),ye(a.label)?(e.openBlock(),e.createElementBlock("span",J,e.toDisplayString(he(a.label)),1)):e.createCommentVNode("v-if",!0),e.createElementVNode("input",{class:e.normalizeClass(["page-input",{"has-collision":xe(a.label)}]),type:"text",value:be(a.label),placeholder:ge("labkipackmanager-page-title-placeholder")||"PageTitle",disabled:!Ne(a.label),readonly:!Ne(a.label),onInput:e=>Se(e,a.label),onFocus:()=>console.log("[Page Input Focus] Page:",a.label,"Editable:",Ne(a.label),"Pack action:",p.value?.action),"aria-invalid":xe(a.label)?"true":"false",style:e.normalizeStyle({fontSize:"0.72em",padding:"4px 7px",flex:"1",minWidth:"100px",border:xe(a.label)?"1px solid #d33":"1px solid #c8ccd1",borderRadius:ye(a.label)?"0 3px 3px 0":"3px",background:xe(a.label)?"#fff5f5":"white",fontFamily:"Monaco, Menlo, Consolas, monospace",transition:"all 0.15s ease",cursor:Ne(a.label)?"text":"not-allowed"})},null,46,Z),xe(a.label)?(e.openBlock(),e.createElementBlock("span",{key:1,class:"collision-icon",style:{fontSize:"1.1em",cursor:"help",color:"#d33"},id:(t=a.label,`collision-${l.node.label}-${t}`),title:we(a.label)},"âš ï¸",8,X)):e.createCommentVNode("v-if",!0)])):e.createCommentVNode("v-if",!0)],4);var t}),128))])):e.createCommentVNode("v-if",!0)]),e.createCommentVNode(" Description and dependencies below both columns "),e.createCommentVNode(" Description and dependencies on second row if present "),n.node.description||n.node.depends_on?.length?(e.openBlock(),e.createElementBlock("div",ee,[e.createElementVNode("div",ae,[n.node.description?(e.openBlock(),e.createElementBlock("div",te,e.toDisplayString(n.node.description),1)):e.createCommentVNode("v-if",!0),n.node.depends_on?.length?(e.openBlock(),e.createElementBlock("div",ne,[e.createElementVNode("small",null,e.toDisplayString(ge("labkipackmanager-depends-on"))+": "+e.toDisplayString(n.node.depends_on.join(", ")),1)])):e.createCommentVNode("v-if",!0)])])):e.createCommentVNode("v-if",!0),e.createCommentVNode(' \n          NESTED PACKS CONTAINER - Only renders nested PACKS (pages shown inline above)\n          âš ï¸ This is what creates the "recursive card nesting" effect\n          - Children are inside the .pack-card div, not siblings\n          - Each child pack creates its own card, nested inside this one\n          - Visual indentation via left border + paddingLeft\n        '),e.createVNode(e.Transition,{name:"children",onEnter:_e,onLeave:Ce},{default:e.withCtx(()=>[i.value&&Ee.value.length>0?(e.openBlock(),e.createElementBlock("div",oe,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(Ee.value,a=>(e.openBlock(),e.createBlock(r,{key:a.id,node:a,depth:n.depth+1,"parent-pack-name":g.value,onSetPackAction:o[0]||(o[0]=e=>t.$emit("set-pack-action",e))},null,8,["node","depth","parent-pack-name"]))),128))])):e.createCommentVNode("v-if",!0)]),_:1})],12,M)):"page"===n.node.type?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createCommentVNode(" \n        PAGE ROW - Only rendered for standalone pages (not in a pack's children)\n        This handles edge case where pages might be at root level\n      "),e.createElementVNode("div",{class:"page-row",style:e.normalizeStyle({padding:"8px 12px",background:y.value?.installed?"rgba(232, 240, 248, 0.4)":"install"===x.value?"rgba(232, 245, 233, 0.6)":"remove"===x.value?"rgba(255, 235, 238, 0.6)":"rgba(255, 255, 255, 0.5)",borderRadius:"6px",marginBottom:"6px"})},[o[5]||(o[5]=e.createElementVNode("span",{class:"toggle-spacer"},null,-1)),o[6]||(o[6]=e.createElementVNode("span",{class:"node-icon"},"ðŸ“„",-1)),e.createElementVNode("strong",le,e.toDisplayString(n.node.label),1),e.createCommentVNode(" Page rename editor "),b.value?(e.openBlock(),e.createElementBlock("span",re,[o[4]||(o[4]=e.createElementVNode("span",{class:"arrow"},"â†’",-1)),w.value?(e.openBlock(),e.createElementBlock("span",ie,e.toDisplayString(N.value),1)):e.createCommentVNode("v-if",!0),e.createElementVNode("input",{class:e.normalizeClass(["page-input",{"has-collision":V.value}]),type:"text",value:S.value,placeholder:ge("labkipackmanager-page-title-placeholder")||"PageTitle",disabled:!h.value,readonly:!h.value,onInput:fe,"aria-invalid":V.value?"true":"false","aria-describedby":V.value?_.value:void 0},null,42,se),V.value?(e.openBlock(),e.createElementBlock("span",{key:1,class:"collision-icon",id:_.value,title:E.value},"âš ï¸",8,ce)):e.createCommentVNode("v-if",!0)])):e.createCommentVNode("v-if",!0)],4)],2112)):e.createCommentVNode("v-if",!0)],10,D)],2112)}},__file:"resources/src/ui/TreeNode.vue"};const pe={class:"hierarchy-tree-container"},ue={key:0,class:"no-hierarchy"},me={key:1,class:"tree-content"},fe={class:"tree-stats"},ge={class:"tree-nodes labki-tree"};var ve={__name:"HierarchyTree",props:{hierarchy:Object},setup(a){async function n(e){await async function(e,a){if(t.busy)return;try{t.busy=!0,console.log(`[sendCommand] Sending ${e}:`,a);const n=await s({command:e,repo_url:t.repoUrl,ref:t.ref,data:a});console.log("[sendCommand] Response diff:",n.diff),console.log("[sendCommand] Pack state before merge:",a.pack_name?t.packs[a.pack_name]:"N/A"),R(t.packs,n.diff),t.stateHash=n.state_hash,t.warnings=n.warnings,console.log("[sendCommand] Pack state after merge:",a.pack_name?t.packs[a.pack_name]:"N/A")}catch(e){console.error("Command failed:",e)}finally{t.busy=!1}}("set_pack_action",{pack_name:e.pack_name,action:e.action})}function o(e){return mw.msg(e)}return(t,l)=>(e.openBlock(),e.createElementBlock("div",pe,[e.createElementVNode("h3",null,e.toDisplayString(o("labkipackmanager-hierarchy-title")),1),a.hierarchy?(e.openBlock(),e.createElementBlock("div",me,[e.createElementVNode("div",fe,[e.createElementVNode("span",null,e.toDisplayString(o("labkipackmanager-pack-count"))+": "+e.toDisplayString(a.hierarchy.meta.pack_count),1),e.createElementVNode("span",null,e.toDisplayString(o("labkipackmanager-page-count"))+": "+e.toDisplayString(a.hierarchy.meta.page_count),1)]),e.createElementVNode("div",ge,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.hierarchy.root_nodes,a=>(e.openBlock(),e.createBlock(de,{key:a.id,node:a,depth:0,onSetPackAction:n},null,8,["node"]))),128))])])):(e.openBlock(),e.createElementBlock("div",ue,[e.createElementVNode("p",null,e.toDisplayString(o("labkipackmanager-no-hierarchy-loaded")),1)]))]))},__scopeId:"data-v-adb05fca",__file:"resources/src/ui/HierarchyTree.vue"};const ke={class:"details-panel"},ye={class:"panel-header"},he={key:0,class:"pack-count-badge"},be={class:"panel-content"},xe={key:0,class:"warnings-section"},we={class:"section-header"},Ne={class:"warnings-list"},Se={key:1,class:"selected-packs-section"},Ve={class:"section-header"},Ee={class:"packs-grid"},_e={class:"pack-header",style:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:"10px",marginBottom:"10px"}},Ce={class:"pack-title-section",style:{display:"flex",alignItems:"flex-start",gap:"10px",flex:"1"}},Be={class:"pack-name-wrapper",style:{display:"flex",flexDirection:"column",gap:"6px",minWidth:"0"}},Re={class:"pack-name",style:{fontSize:"1em",color:"#202122",wordBreak:"break-word"}},Te={class:"pack-meta-row",style:{display:"flex",alignItems:"center",gap:"6px",flexWrap:"wrap"}},Ae=["title"],De={key:1,class:"pack-badge manual",style:{fontSize:"0.7em",padding:"3px 8px",borderRadius:"5px",fontWeight:"600",background:"linear-gradient(135deg, #eaf3ff 0%, #f0f6ff 100%)",color:"#36c",border:"1px solid #a8c9f0",whiteSpace:"nowrap"}},Me={key:0,style:{fontSize:"1.2em"}},Pe={key:1,class:"status-icon spinning",style:{fontSize:"1.2em"}},Ie={key:2,style:{fontSize:"1.2em"}},Le={key:3,style:{fontSize:"1.2em"}},ze={class:"status-text",style:{fontWeight:"700"}},Oe={class:"pack-info-grid",style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(110px, 1fr))",gap:"8px",paddingTop:"10px",marginTop:"2px",borderTop:"1px solid #eaecf0"}},Ue={key:0,class:"info-item",style:{display:"flex",flexDirection:"column",gap:"4px",padding:"6px 10px",background:"#f8f9fa",borderRadius:"6px",border:"1px solid #eaecf0"}},We={class:"info-value",style:{fontSize:"0.88em",color:"#202122",fontWeight:"600"}},$e={key:1,class:"info-item",style:{display:"flex",flexDirection:"column",gap:"4px",padding:"6px 10px",background:"#f8f9fa",borderRadius:"6px",border:"1px solid #eaecf0"}},Fe={class:"info-value code",style:{fontSize:"0.85em",color:"#202122",fontWeight:"500",fontFamily:"Monaco, Menlo, Consolas, monospace",background:"white",padding:"3px 6px",borderRadius:"3px",border:"1px solid #c8ccd1"}},He={class:"info-label",style:{fontSize:"0.65em",color:"#72777d",fontWeight:"700",textTransform:"uppercase",letterSpacing:"0.4px"}},Ge={class:"pages-list",style:{display:"flex",flexDirection:"column",gap:"3px"}},je=["title"],qe={key:2,class:"empty-state"},Ye={class:"empty-text"},Ke={class:"actions-section"},Qe={class:"action-buttons"},Je={key:2,class:"state-info"};var Ze={__name:"DetailsPanel",setup(n){const o=e.ref(""),l=e.ref(""),r=e.ref({}),i=e.computed(()=>{const e=[];for(const[a,n]of Object.entries(t.packs))n.action&&"unchanged"!==n.action&&e.push({name:a,state:n,pageCount:Object.keys(n.pages||{}).length});return e});async function c(){if(!t.busy)try{t.busy=!0,o.value="",l.value="",r.value={};for(const e of i.value)r.value[e.name]="pending";o.value="Queueing pack operations...";const e=await s({command:"apply",repo_url:t.repoUrl,ref:t.ref,data:{packs:t.packs,state_hash:t.stateHash}});if(console.log("[onApply] Apply response:",e),R(t.packs,e.diff),t.stateHash=e.state_hash,t.warnings=e.warnings,e.operation?.operation_id){const a=e.operation.operation_id;console.log(`[onApply] Polling operation ${a}...`),await d(a,120,1e3,e=>{e.message?(o.value=e.message,function(e){const a=e.match(/Installing pack[:\s]+(.+)/i),t=e.match(/Updating pack[:\s]+(.+)/i),n=e.match(/Removing pack[:\s]+(.+)/i),o=e.match(/Completed pack[:\s]+(.+)/i);if(a||t||n){const e=(a||t||n)[1].trim();void 0!==r.value[e]&&(r.value[e]="running")}else if(o){const e=o[1].trim();void 0!==r.value[e]&&(r.value[e]="complete")}}(e.message)):"queued"===e.status?o.value="Waiting for job to start...":"running"===e.status&&(o.value=`Applying packs... (${e.progress||0}%)`)}),console.log("[onApply] Operation completed successfully");for(const e in r.value)"failed"!==r.value[e]&&(r.value[e]="complete");o.value="All packs applied successfully!",setTimeout(()=>{r.value={}},3e3)}else o.value=g("labkipackmanager-apply-success"),r.value={}}catch(e){console.error("[onApply] Error:",e),l.value=e instanceof Error?e.message:String(e),o.value="";for(const e in r.value)r.value[e]="failed"}finally{t.busy=!1}}function p(e){switch(e){case"pending":return"Pending";case"running":return"In Progress";case"complete":return"Complete";case"failed":return"Failed";default:return""}}function u(e){switch(e){case"install":return"â¬‡ï¸";case"update":return"ðŸ”„";case"remove":return"ðŸ—‘ï¸";default:return""}}async function m(){if(!t.busy)try{t.busy=!0,o.value="",l.value="";const e=await s({command:"refresh",repo_url:t.repoUrl,ref:t.ref,data:{}});R(t.packs,e.diff),t.stateHash=e.state_hash,t.warnings=e.warnings,o.value=g("labkipackmanager-refresh-success")}catch(e){l.value=e instanceof Error?e.message:String(e)}finally{t.busy=!1}}async function f(){if(!t.busy&&confirm(g("labkipackmanager-clear-confirm")))try{t.busy=!0,o.value="",l.value="",t.packs={},t.warnings=[];const e=await s({command:"clear",repo_url:t.repoUrl,ref:t.ref,data:{}});t.packs=e.diff,t.stateHash=e.state_hash,t.warnings=e.warnings,o.value=g("labkipackmanager-clear-success")}catch(e){l.value=e instanceof Error?e.message:String(e)}finally{t.busy=!1}}function g(e){return mw.msg(e)}return(n,s)=>(e.openBlock(),e.createElementBlock("div",ke,[e.createElementVNode("div",ye,[e.createElementVNode("h3",null,e.toDisplayString(g("labkipackmanager-details-title")),1),i.value.length>0?(e.openBlock(),e.createElementBlock("div",he,e.toDisplayString(i.value.length)+" "+e.toDisplayString(1===i.value.length?"pack":"packs"),1)):e.createCommentVNode("v-if",!0)]),e.createElementVNode("div",be,[e.createCommentVNode(" Warnings Section "),e.unref(t).warnings.length>0?(e.openBlock(),e.createElementBlock("div",xe,[e.createElementVNode("div",we,[s[0]||(s[0]=e.createElementVNode("span",{class:"section-icon"},"âš ï¸",-1)),e.createElementVNode("h4",null,e.toDisplayString(g("labkipackmanager-warnings")),1)]),e.createElementVNode("div",Ne,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(t).warnings,(t,n)=>(e.openBlock(),e.createBlock(e.unref(a.CdxMessage),{key:n,type:"warning",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t),1)]),_:2},1024))),128))])])):e.createCommentVNode("v-if",!0),e.createCommentVNode(" Selected Packs Section "),i.value.length>0?(e.openBlock(),e.createElementBlock("div",Se,[e.createElementVNode("div",Ve,[s[1]||(s[1]=e.createElementVNode("span",{class:"section-icon"},"ðŸ“¦",-1)),e.createElementVNode("h4",null,e.toDisplayString(g("labkipackmanager-selected-packs")),1)]),e.createElementVNode("div",Ee,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,a=>(e.openBlock(),e.createElementBlock("div",{key:a.name,class:"pack-card",style:e.normalizeStyle({position:"relative",padding:"12px 14px",paddingLeft:r.value[a.name]?"20px":"14px",background:"running"===r.value[a.name]?"linear-gradient(135deg, #f0f5ff 0%, #ffffff 100%)":"complete"===r.value[a.name]?"linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%)":"failed"===r.value[a.name]?"linear-gradient(135deg, #fff5f5 0%, #ffffff 100%)":"pending"===r.value[a.name]?"#fafbfc":"white",border:"2px solid #eaecf0",borderLeft:"running"===r.value[a.name]?"4px solid #3366cc":"complete"===r.value[a.name]?"4px solid #14866d":"failed"===r.value[a.name]?"4px solid #d33":"pending"===r.value[a.name]?"4px solid #c8ccd1":"2px solid #eaecf0",borderRadius:"10px",boxShadow:"0 2px 6px rgba(0, 0, 0, 0.08)",marginBottom:"10px",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",overflow:"hidden"})},[e.createElementVNode("div",_e,[e.createElementVNode("div",Ce,[s[2]||(s[2]=e.createElementVNode("div",{class:"pack-icon",style:{fontSize:"1.6em",lineHeight:"1"}},"ðŸ“¦",-1)),e.createElementVNode("div",Be,[e.createElementVNode("strong",Re,e.toDisplayString(a.name),1),e.createElementVNode("div",Te,[a.state.auto_selected_reason?(e.openBlock(),e.createElementBlock("span",{key:0,class:"pack-badge auto",title:a.state.auto_selected_reason,style:{fontSize:"0.7em",padding:"3px 8px",borderRadius:"5px",fontWeight:"600",background:"linear-gradient(135deg, #fef6e7 0%, #fff8e1 100%)",color:"#ac6600",border:"1px solid #f0d86f",whiteSpace:"nowrap"}}," ðŸ¤– Auto ",8,Ae)):(e.openBlock(),e.createElementBlock("span",De," âœ‹ Manual ")),e.createElementVNode("span",{class:"action-badge",style:e.normalizeStyle({fontSize:"0.7em",padding:"3px 10px",borderRadius:"5px",fontWeight:"700",textTransform:"uppercase",letterSpacing:"0.3px",whiteSpace:"nowrap",background:"install"===a.state.action?"linear-gradient(135deg, #d5fdf0 0%, #e8fff8 100%)":"update"===a.state.action?"linear-gradient(135deg, #fff4e5 0%, #fff8ed 100%)":"remove"===a.state.action?"linear-gradient(135deg, #fee7e6 0%, #fff0ef 100%)":"#f8f9fa",color:"install"===a.state.action?"#14866d":"update"===a.state.action?"#ac6600":"remove"===a.state.action?"#d33":"#54595d",border:"install"===a.state.action?"1px solid #7fd4bf":"update"===a.state.action?"1px solid #f0c77e":"remove"===a.state.action?"1px solid #faa":"1px solid #c8ccd1"})},e.toDisplayString(u(a.state.action))+" "+e.toDisplayString(a.state.action),5)])])]),e.createCommentVNode(" Operation Status Badge "),r.value[a.name]?(e.openBlock(),e.createElementBlock("div",{key:0,class:"operation-status",style:e.normalizeStyle({display:"flex",alignItems:"center",gap:"6px",padding:"5px 12px",borderRadius:"16px",fontSize:"0.8em",fontWeight:"700",whiteSpace:"nowrap",flexShrink:"0",background:"pending"===r.value[a.name]?"linear-gradient(135deg, #f8f9fa 0%, #eaecf0 100%)":"running"===r.value[a.name]?"linear-gradient(135deg, #3366cc 0%, #447ff5 100%)":"complete"===r.value[a.name]?"linear-gradient(135deg, #14866d 0%, #00af89 100%)":"linear-gradient(135deg, #d33 0%, #ff4444 100%)",color:"pending"===r.value[a.name]?"#54595d":"white",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)",animation:"running"===r.value[a.name]?"pulse 2s ease-in-out infinite":"none"})},["pending"===r.value[a.name]?(e.openBlock(),e.createElementBlock("span",Me,"â³")):"running"===r.value[a.name]?(e.openBlock(),e.createElementBlock("span",Pe,"âš™ï¸")):"complete"===r.value[a.name]?(e.openBlock(),e.createElementBlock("span",Ie,"âœ…")):"failed"===r.value[a.name]?(e.openBlock(),e.createElementBlock("span",Le,"âŒ")):e.createCommentVNode("v-if",!0),e.createElementVNode("span",ze,e.toDisplayString(p(r.value[a.name])),1)],4)):e.createCommentVNode("v-if",!0)]),e.createElementVNode("div",Oe,[a.state.target_version?(e.openBlock(),e.createElementBlock("div",Ue,[s[3]||(s[3]=e.createElementVNode("span",{class:"info-label",style:{fontSize:"0.65em",color:"#72777d",fontWeight:"700",textTransform:"uppercase",letterSpacing:"0.4px"}},"Version",-1)),e.createElementVNode("span",We,e.toDisplayString(a.state.target_version),1)])):e.createCommentVNode("v-if",!0),a.state.prefix?(e.openBlock(),e.createElementBlock("div",$e,[s[4]||(s[4]=e.createElementVNode("span",{class:"info-label",style:{fontSize:"0.65em",color:"#72777d",fontWeight:"700",textTransform:"uppercase",letterSpacing:"0.4px"}},"Prefix",-1)),e.createElementVNode("span",Fe,e.toDisplayString(a.state.prefix),1)])):e.createCommentVNode("v-if",!0),a.pageCount>0?(e.openBlock(),e.createElementBlock("div",{key:2,class:"info-item",style:e.normalizeStyle({display:"flex",flexDirection:"column",gap:"6px",padding:"6px 10px",background:"#f8f9fa",borderRadius:"6px",border:"1px solid #eaecf0",gridColumn:a.state.prefix?"span 1":"span 2"})},[e.createElementVNode("span",He,"Pages ("+e.toDisplayString(a.pageCount)+")",1),e.createElementVNode("div",Ge,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.state.pages,(a,t)=>(e.openBlock(),e.createElementBlock("div",{key:t,style:{fontSize:"0.75em",color:"#202122",padding:"2px 4px",background:"white",borderRadius:"3px",border:"1px solid #eaecf0",fontFamily:"Monaco, Menlo, Consolas, monospace",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:`${t} â†’ ${a.final_title}`},[s[5]||(s[5]=e.createElementVNode("span",{style:{color:"#72777d"}},"ðŸ“„",-1)),e.createTextVNode(" "+e.toDisplayString(a.final_title||t),1)],8,je))),128))])],4)):e.createCommentVNode("v-if",!0)])],4))),128))])])):(e.openBlock(),e.createElementBlock("div",qe,[s[6]||(s[6]=e.createElementVNode("div",{class:"empty-icon"},"ðŸ“‹",-1)),e.createElementVNode("p",Ye,e.toDisplayString(g("labkipackmanager-no-packs-selected")),1),s[7]||(s[7]=e.createElementVNode("p",{class:"empty-hint"},"Select packs from the hierarchy tree to see details here",-1))])),e.createCommentVNode(" Action Buttons "),e.createElementVNode("div",Ke,[e.createElementVNode("div",Qe,[e.createVNode(e.unref(a.CdxButton),{action:"progressive",weight:"primary",disabled:e.unref(t).busy||0===i.value.length,onClick:c},{default:e.withCtx(()=>[e.createTextVNode(" âœ“ "+e.toDisplayString(g("labkipackmanager-apply")),1)]),_:1},8,["disabled"]),e.createVNode(e.unref(a.CdxButton),{action:"default",disabled:e.unref(t).busy,onClick:m},{default:e.withCtx(()=>[e.createTextVNode(" ðŸ”„ "+e.toDisplayString(g("labkipackmanager-refresh")),1)]),_:1},8,["disabled"]),e.createVNode(e.unref(a.CdxButton),{action:"destructive",weight:"quiet",disabled:e.unref(t).busy,onClick:f},{default:e.withCtx(()=>[e.createTextVNode(" âœ• "+e.toDisplayString(g("labkipackmanager-clear")),1)]),_:1},8,["disabled"])]),e.createCommentVNode(" Operation Status "),o.value?(e.openBlock(),e.createBlock(e.unref(a.CdxMessage),{key:0,type:"success",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.value),1)]),_:1})):e.createCommentVNode("v-if",!0),l.value?(e.openBlock(),e.createBlock(e.unref(a.CdxMessage),{key:1,type:"error",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(l.value),1)]),_:1})):e.createCommentVNode("v-if",!0),e.createCommentVNode(" State Hash (Debug) "),e.unref(t).stateHash?(e.openBlock(),e.createElementBlock("div",Je,[e.createElementVNode("small",null,[e.createTextVNode(e.toDisplayString(g("labkipackmanager-state-hash"))+": ",1),e.createElementVNode("code",null,e.toDisplayString(e.unref(t).stateHash),1)])])):e.createCommentVNode("v-if",!0)])])]))},__scopeId:"data-v-348c6e2c",__file:"resources/src/ui/DetailsPanel.vue"};const Xe={class:"labki-pack-manager-app"},ea={class:"app-header"},aa={class:"app-description"},ta={key:0,class:"loading-overlay"},na={class:"loading-spinner"},oa={class:"app-main"};var la={__name:"App",setup(a){function n(e){return mw.msg(e)}return e.onMounted(()=>{console.log("Labki Pack Manager initialized")}),(a,o)=>(e.openBlock(),e.createElementBlock("div",Xe,[e.createElementVNode("header",ea,[e.createElementVNode("h1",null,e.toDisplayString(n("labkipackmanager-special-title")),1),e.createElementVNode("p",aa,e.toDisplayString(n("labkipackmanager-special-description")),1)]),e.unref(t).busy?(e.openBlock(),e.createElementBlock("div",ta,[e.createElementVNode("div",na,e.toDisplayString(n("labkipackmanager-loading"))+"... ",1)])):e.createCommentVNode("v-if",!0),e.createElementVNode("main",oa,[e.createVNode(S),e.unref(t).repoUrl&&e.unref(t).ref?(e.openBlock(),e.createBlock(B,{key:0,"mermaid-src":e.unref(t).mermaidSrc},null,8,["mermaid-src"])):e.createCommentVNode("v-if",!0),e.unref(t).repoUrl&&e.unref(t).ref?(e.openBlock(),e.createBlock(ve,{key:1,hierarchy:e.unref(t).hierarchy},null,8,["hierarchy"])):e.createCommentVNode("v-if",!0),e.unref(t).repoUrl&&e.unref(t).ref?(e.openBlock(),e.createBlock(Ze,{key:2})):e.createCommentVNode("v-if",!0)])]))}};la.__scopeId="data-v-23151fc9",la.__file="resources/src/ui/App.vue",console.log("Labki Pack Manager: main.ts loading..."),console.log("Labki Pack Manager: imports complete"),console.log("Labki Pack Manager: Checking MediaWiki environment..."),"undefined"!=typeof mw&&mw.loader?(console.log("Labki Pack Manager: MediaWiki environment available, starting bootstrap"),console.log("Labki Pack Manager: bootstrap called"),mw.loader.using(["vue","mediawiki.api","@wikimedia/codex","codex-styles"]).then(()=>{console.log("Labki Pack Manager: All modules loaded, initializing app"),function(){console.log("Labki Pack Manager: initApp called");const a=document.getElementById("labki-pack-manager-root");a?(console.log("Labki Pack Manager: Root element found, creating app"),e.createApp(la).mount(a),console.log("Labki Pack Manager: Application mounted")):console.error("Labki Pack Manager: Root element not found")}()}).catch(e=>{console.error("Labki Pack Manager: Failed to load required modules",e)})):console.error("Labki Pack Manager: MediaWiki environment not available")}(Vue,Codex);
//# sourceMappingURL=app.bundle.js.map
