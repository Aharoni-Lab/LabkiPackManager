var Vue="undefined"!=typeof mw&&mw.loader&&mw.loader.require?mw.loader.require("vue"):window.Vue,Codex="undefined"!=typeof mw&&mw.loader&&mw.loader.require?mw.loader.require("@wikimedia/codex")||mw.loader.require("codex"):window.Codex,mermaid=function(){try{if("undefined"!=typeof window&&window.mermaid)return window.mermaid;if("undefined"!=typeof mw&&mw.loader&&mw.loader.require){var e=mw.loader.require("ext.mermaid");if(e?.initialize)return e;if(e?.mermaid?.initialize)return e.mermaid;if(e?.default?.initialize)return e.default}}catch(e){}return window.mermaid}();!function(e,a){"use strict";const t=e.reactive({repoUrl:"",ref:"",mermaidSrc:"",hierarchy:null,packs:{},stateHash:"",warnings:[],busy:!1,selectedRepo:null,repos:[]});function o(){return new mw.Api}async function n(e){try{return await e()}catch(e){throw console.error("API call failed:",e),e}}async function r(e,a){return n(async()=>{const t=o();return(await t.post({action:"labkiReposAdd",format:"json",repo_url:e,default_ref:a})).labkiReposAdd})}async function l(e,a){return n(async()=>{const t=o(),n=await t.get({action:"labkiGraphGet",format:"json",repo_url:e,ref:a});console.log("[graphGet] Response:",n);let r=n.labkiGraphGet;if(!r){if(!(n.graph&&n.repo_url&&n.ref))throw new Error("Invalid graphGet response structure");console.log("[graphGet] Using unwrapped response"),r=n}return r})}async function i(e,a){return n(async()=>{const t=o(),n=await t.get({action:"labkiHierarchyGet",format:"json",repo_url:e,ref:a});console.log("[hierarchyGet] Response:",n);let r=n.labkiHierarchyGet;if(!r){if(!(n.hierarchy&&n.repo_url&&n.ref))throw new Error("Invalid hierarchyGet response structure");console.log("[hierarchyGet] Using unwrapped response"),r=n}return r})}async function c(e){return n(async()=>{const a=o();console.log("[packsAction] Sending payload:",e);const t=await a.post({action:"labkiPacksAction",format:"json",payload:JSON.stringify(e)});console.log("[packsAction] Raw response:",t);let n=t.labkiPacksAction;if(!n)throw console.error("[packsAction] Cannot find labkiPacksAction in response:",JSON.stringify(t,null,2)),new Error("Invalid packsAction response structure");return console.log("[packsAction] Returning:",n),n})}const s={class:"add-repo-form"},d={class:"error"};var p={__name:"AddRepoModal",props:{modelValue:Boolean},emits:["update:modelValue","added"],setup(t,{emit:o}){const n=t,l=o,i=e.computed({get:()=>n.modelValue,set:e=>l("update:modelValue",e)}),c=e.ref(""),p=e.ref("main"),u=e.ref(""),m=e.ref(""),k=e.ref(!1),f=e.computed(()=>""!==c.value.trim()&&""!==p.value.trim()&&!u.value);function g(){u.value="";const e=c.value.trim();if(e)try{new URL(e),e.match(/^(https?|git|ssh):\/\//)||(u.value=mw.msg("labkipackmanager-error-invalid-protocol"))}catch{u.value=mw.msg("labkipackmanager-error-invalid-url")}}async function v(){if(f.value&&!k.value){k.value=!0,m.value="";try{await r(c.value.trim(),p.value.trim()),l("added",c.value.trim()),y()}catch(e){m.value=e instanceof Error?e.message:String(e)}finally{k.value=!1}}}function y(){c.value="",p.value="main",u.value="",m.value="",i.value=!1}function h(e){return mw.msg(e)}return(t,o)=>(e.openBlock(),e.createBlock(e.unref(a.CdxDialog),{open:i.value,"onUpdate:open":o[2]||(o[2]=e=>i.value=e),title:h("labkipackmanager-add-repo-title"),"primary-action":{label:h("labkipackmanager-add-repo-submit"),actionType:"progressive",disabled:k.value||!f.value},"default-action":{label:h("labkipackmanager-cancel")},onPrimary:v,onDefault:y},{default:e.withCtx(()=>[e.createElementVNode("div",s,[e.createVNode(e.unref(a.CdxField),{"is-fieldset":!1},e.createSlots({label:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(h("labkipackmanager-repo-url-label")),1)]),default:e.withCtx(()=>[e.createVNode(e.unref(a.CdxTextInput),{modelValue:c.value,"onUpdate:modelValue":[o[0]||(o[0]=e=>c.value=e),g],placeholder:h("labkipackmanager-repo-url-placeholder"),disabled:k.value},null,8,["modelValue","placeholder","disabled"])]),_:2},[u.value?{name:"help-text",fn:e.withCtx(()=>[e.createElementVNode("span",d,e.toDisplayString(u.value),1)]),key:"0"}:void 0]),1024),e.createVNode(e.unref(a.CdxField),{"is-fieldset":!1},{label:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(h("labkipackmanager-default-ref-label")),1)]),default:e.withCtx(()=>[e.createVNode(e.unref(a.CdxTextInput),{modelValue:p.value,"onUpdate:modelValue":o[1]||(o[1]=e=>p.value=e),placeholder:h("labkipackmanager-default-ref-placeholder"),disabled:k.value},null,8,["modelValue","placeholder","disabled"])]),_:1}),m.value?(e.openBlock(),e.createBlock(e.unref(a.CdxMessage),{key:0,type:"error",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(m.value),1)]),_:1})):e.createCommentVNode("v-if",!0)])]),_:1},8,["open","title","primary-action","default-action"]))},__scopeId:"data-v-0cf6aec2",__file:"resources/src/ui/AddRepoModal.vue"};const u={class:"add-ref-form"},m={class:"repo-info"};var k={__name:"AddRefModal",props:{modelValue:Boolean,repoUrl:String},emits:["update:modelValue","added"],setup(t,{emit:o}){const n=t,l=o,i=e.computed({get:()=>n.modelValue,set:e=>l("update:modelValue",e)}),c=e.ref(""),s=e.ref(""),d=e.ref(!1),p=e.computed(()=>""!==c.value.trim());async function k(){if(p.value&&!d.value){d.value=!0,s.value="";try{await r(n.repoUrl,c.value.trim()),l("added",c.value.trim()),f()}catch(e){s.value=e instanceof Error?e.message:String(e)}finally{d.value=!1}}}function f(){c.value="",s.value="",i.value=!1}function g(e){return mw.msg(e)}return(o,n)=>(e.openBlock(),e.createBlock(e.unref(a.CdxDialog),{open:i.value,"onUpdate:open":n[1]||(n[1]=e=>i.value=e),title:g("labkipackmanager-add-ref-title"),"primary-action":{label:g("labkipackmanager-add-ref-submit"),actionType:"progressive",disabled:d.value||!p.value},"default-action":{label:g("labkipackmanager-cancel")},onPrimary:k,onDefault:f},{default:e.withCtx(()=>[e.createElementVNode("div",u,[e.createElementVNode("p",m,[e.createElementVNode("strong",null,e.toDisplayString(g("labkipackmanager-repository"))+":",1),e.createTextVNode(" "+e.toDisplayString(t.repoUrl),1)]),e.createVNode(e.unref(a.CdxField),{"is-fieldset":!1},{label:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(g("labkipackmanager-ref-name-label")),1)]),default:e.withCtx(()=>[e.createVNode(e.unref(a.CdxTextInput),{modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=e=>c.value=e),placeholder:g("labkipackmanager-ref-name-placeholder"),disabled:d.value},null,8,["modelValue","placeholder","disabled"])]),_:1}),s.value?(e.openBlock(),e.createBlock(e.unref(a.CdxMessage),{key:0,type:"error",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(s.value),1)]),_:1})):e.createCommentVNode("v-if",!0)])]),_:1},8,["open","title","primary-action","default-action"]))},__scopeId:"data-v-f029ab7a",__file:"resources/src/ui/AddRefModal.vue"};const f={class:"repo-ref-selector"},g={class:"selector-row",style:{display:"flex",gap:"24px","flex-wrap":"nowrap"}},v={class:"selector-field",style:{flex:"1 1 0","min-width":"0"}},y={class:"selector-field",style:{flex:"1 1 0","min-width":"0"}},h={key:0,class:"current-selection"},b="__add_new_repo__",w="__add_new_ref__";var _={__name:"RepoRefSelector",setup(r){const s=e.ref(""),d=e.ref(""),u=e.ref(!1),m=e.ref(!1),_=e.ref(""),V=e.computed(()=>{if(console.log("Computing repoMenuItems, store.repos:",t.repos),!t.repos||0===t.repos.length)return[{label:"Loading...",value:"",disabled:!0}];const e=t.repos.map(e=>({label:e.repo_url,value:e.repo_url}));return e.push({label:"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",value:"__separator__",disabled:!0}),e.push({label:A("labkipackmanager-add-repo-option"),value:b}),e}),N=e.computed(()=>{if(!t.selectedRepo)return[];const e=t.selectedRepo.refs.map(e=>({label:`${e.ref_name} ${e.is_default?"(default)":""}`,value:e.ref}));return e.push({label:"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",value:"__separator__",disabled:!0}),e.push({label:A("labkipackmanager-add-ref-option"),value:w}),e});async function B(){try{console.log("[loadRepos] Starting..."),t.busy=!0,_.value="",console.log("[loadRepos] Calling reposList API...");const e=await async function(){return n(async()=>{console.log("[reposList] Starting API call...");const e=o();console.log("[reposList] API instance:",e);const a=await e.get({action:"labkiReposList",format:"json"});if(console.log("[reposList] Raw API response:",a),console.log("[reposList] Response keys:",Object.keys(a)),!a)throw new Error("No response from API");let t=a.labkiReposList;if(!t){if(!a.repos||!a.meta)throw console.error("[reposList] Cannot find repos data in response:",JSON.stringify(a,null,2)),new Error("Invalid API response structure - no labkiReposList field and no repos field");console.log("[reposList] Response appears to be unwrapped, using directly"),t=a}return console.log("[reposList] Data structure:",t),console.log("[reposList] Returning:",t),t})}();if(console.log("[loadRepos] API response received:",e),!e)throw new Error("No response from reposList API");if(!e.repos)throw new Error("Invalid response structure - no repos field. Response: "+JSON.stringify(e));console.log("[loadRepos] Setting store.repos:",e.repos),t.repos=e.repos,console.log("[loadRepos] store.repos is now:",t.repos),console.log("[loadRepos] store.repos.length:",t.repos.length),t.repos.length>0&&!s.value&&(console.log("[loadRepos] Auto-selecting first repo:",t.repos[0].repo_url),await x(t.repos[0].repo_url))}catch(e){console.error("[loadRepos] Error:",e),_.value=e instanceof Error?e.message:String(e)}finally{t.busy=!1,console.log("[loadRepos] Finished. store.busy:",t.busy,"store.repos:",t.repos)}}async function S(e){if(e===b)return u.value=!0,void(s.value=t.repoUrl);"string"==typeof e&&e&&"__separator__"!==e&&await x(e)}async function x(e){try{t.busy=!0,_.value="",s.value=e,t.repoUrl=e;const a=t.repos.find(a=>a.repo_url===e);if(!a)throw new Error(A("labkipackmanager-error-repo-not-found"));t.selectedRepo=a;const o=a.refs.find(e=>e.is_default),n=o?.ref||a.refs[0]?.ref;n&&await E(n)}catch(e){_.value=e instanceof Error?e.message:String(e)}finally{t.busy=!1}}async function C(e){if(e===w)return m.value=!0,void(d.value=t.ref);"string"==typeof e&&e&&"__separator__"!==e&&await E(e)}async function E(e){try{t.busy=!0,_.value="",d.value=e,t.ref=e,t.packs={},t.warnings=[];const[a,o]=await Promise.all([l(t.repoUrl,t.ref),i(t.repoUrl,t.ref)]);t.mermaidSrc=function(e){const a=["graph TD"],t=new Set,o=[];for(const a of e.containsEdges||[])t.add(a.from),t.add(a.to),o.push({from:a.from,to:a.to,type:"contains"});for(const a of e.dependsEdges||[])t.add(a.from),t.add(a.to),o.push({from:a.from,to:a.to,type:"depends"});for(const e of t)a.push(`  ${R(e)}["${e}"]`);for(const e of o){const t=R(e.from),o=R(e.to);"depends"===e.type?a.push(`  ${t} -.-> ${o}`):a.push(`  ${t} --\x3e ${o}`)}const n=a.join("\n");return console.log("[buildMermaidFromGraph] Generated Mermaid syntax:\n",n),n}(a.graph),t.hierarchy=o.hierarchy;const n=await c({command:"init",repo_url:t.repoUrl,ref:t.ref,data:{}});t.packs=n.diff,t.stateHash=n.state_hash,t.warnings=n.warnings}catch(e){_.value=e instanceof Error?e.message:String(e)}finally{t.busy=!1}}async function D(e){await B(),await x(e)}async function M(e){s.value&&(await B(),await E(e))}function R(e){return e.replace(/[^a-zA-Z0-9_]/g,"_")}function A(e){return mw.msg(e)}return e.onMounted(async()=>{console.log("RepoRefSelector mounted, store:",t),await B()}),(o,n)=>(e.openBlock(),e.createElementBlock("div",f,[e.createElementVNode("h2",null,e.toDisplayString(A("labkipackmanager-select-source")),1),e.createElementVNode("div",g,[e.createElementVNode("div",v,[e.createVNode(e.unref(a.CdxField),null,{label:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(A("labkipackmanager-repo-selector-label")),1)]),default:e.withCtx(()=>[e.createVNode(e.unref(a.CdxSelect),{selected:s.value,"onUpdate:selected":[n[0]||(n[0]=e=>s.value=e),S],"menu-items":V.value,disabled:e.unref(t).busy},null,8,["selected","menu-items","disabled"])]),_:1})]),e.createElementVNode("div",y,[e.createVNode(e.unref(a.CdxField),null,{label:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(A("labkipackmanager-ref-selector-label")),1)]),default:e.withCtx(()=>[e.createVNode(e.unref(a.CdxSelect),{selected:d.value,"onUpdate:selected":[n[1]||(n[1]=e=>d.value=e),C],"menu-items":N.value,disabled:e.unref(t).busy||!s.value},null,8,["selected","menu-items","disabled"])]),_:1})])]),s.value&&d.value?(e.openBlock(),e.createElementBlock("div",h,[e.createElementVNode("strong",null,e.toDisplayString(A("labkipackmanager-current-selection"))+":",1),e.createTextVNode(" "+e.toDisplayString(s.value)+" @ "+e.toDisplayString(d.value),1)])):e.createCommentVNode("v-if",!0),_.value?(e.openBlock(),e.createBlock(e.unref(a.CdxMessage),{key:1,type:"error",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(_.value),1)]),_:1})):e.createCommentVNode("v-if",!0),e.createVNode(p,{modelValue:u.value,"onUpdate:modelValue":n[2]||(n[2]=e=>u.value=e),onAdded:D},null,8,["modelValue"]),e.createVNode(k,{modelValue:m.value,"onUpdate:modelValue":n[3]||(n[3]=e=>m.value=e),"repo-url":s.value,onAdded:M},null,8,["modelValue","repo-url"])]))},__scopeId:"data-v-a9c77630",__file:"resources/src/ui/RepoRefSelector.vue"};const V={class:"mermaid-graph-container"},N={key:0,class:"no-mermaid-message"},B={key:1,class:"mermaid-wrapper"},S={class:"mermaid"},x={key:2,class:"no-graph-message"};var C={__name:"MermaidGraph",props:{mermaidSrc:String},setup(t){const o=t,n=e.ref(!1);function r(e){return mw.msg(e)}return e.onMounted(()=>{!function(){const e=mw.loader.getState("ext.mermaid");n.value="ready"===e||"loaded"===e||"loading"===e,n.value?console.log("[MermaidGraph] Mermaid extension is available, state:",e):console.warn("Mermaid extension is not available")}()}),e.watch(()=>o.mermaidSrc,async()=>{n.value&&o.mermaidSrc&&(await e.nextTick(),function(){if(console.log("[MermaidGraph] Triggering Mermaid render"),"undefined"!=typeof window&&window.mermaid)try{"function"==typeof window.mermaid.contentLoaded?window.mermaid.contentLoaded():"function"==typeof window.mermaid.run?window.mermaid.run():console.warn("[MermaidGraph] No suitable mermaid render method found")}catch(e){console.warn("[MermaidGraph] Failed to trigger mermaid render:",e)}else console.warn("[MermaidGraph] window.mermaid not available")}())}),(o,l)=>(e.openBlock(),e.createElementBlock("div",V,[e.createElementVNode("h3",null,e.toDisplayString(r("labkipackmanager-graph-title")),1),n.value?t.mermaidSrc?(e.openBlock(),e.createElementBlock("div",B,[e.createElementVNode("pre",S,e.toDisplayString(t.mermaidSrc),1)])):(e.openBlock(),e.createElementBlock("div",x,[e.createElementVNode("p",null,e.toDisplayString(r("labkipackmanager-no-graph-loaded")),1)])):(e.openBlock(),e.createElementBlock("div",N,[e.createVNode(e.unref(a.CdxMessage),{type:"warning",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(r("labkipackmanager-mermaid-not-installed")),1)]),_:1})]))]))}};function E(e,a){for(const[t,o]of Object.entries(a)){const a=e[t]??{};e[t]=D(a,o)}}function D(e,a){const t=e.action,o={...e,...a};if(void 0!==t&&(o.action=t),a.pages){o.pages={...e.pages??{}};for(const[e,t]of Object.entries(a.pages)){const a=o.pages[e]??{};o.pages[e]=M(a,t)}}return o}function M(e,a){return{...e,...a}}C.__scopeId="data-v-04226ecd",C.__file="resources/src/ui/MermaidGraph.vue";const R={key:1,class:"expand-spacer"},A={class:"node-content"},P={class:"node-label"},L={class:"node-icon"},T={key:0,class:"node-version"},U={key:0,class:"node-description"},I={key:1,class:"node-depends"},G={key:2,class:"node-actions"},j={key:0,class:"node-children"};var $={__name:"TreeNode",props:{node:Object,depth:Number},emits:["select-pack","deselect-pack","set-pack-action"],setup(o,{emit:n}){const r=o,l=n,i=e.ref(r.depth<2),c=e.computed(()=>"pack"!==r.node.type?null:t.packs[r.node.label]||null),s=e.computed(()=>!!c.value&&(null!==c.value.current_version&&(!!c.value.target_version&&c.value.target_version>c.value.current_version))),d=e.computed(()=>c.value?c.value.auto_selected?"status-auto":c.value.selected?"status-selected":"":""),p=e.computed(()=>c.value?c.value.auto_selected?`(${y("labkipackmanager-auto-selected")})`:c.value.selected?`(${y("labkipackmanager-selected")})`:"":""),u=e.computed(()=>c.value&&"install"===c.value.action?{border:"2px solid #36c",boxShadow:"inset 0 0 4px rgba(0, 0, 0, 0.2)",fontWeight:"bold"}:{}),m=e.computed(()=>c.value&&"update"===c.value.action?{border:"2px solid #36c",boxShadow:"inset 0 0 4px rgba(0, 0, 0, 0.2)",fontWeight:"bold"}:{}),k=e.computed(()=>c.value&&"remove"===c.value.action?{border:"2px solid #36c",boxShadow:"inset 0 0 4px rgba(0, 0, 0, 0.2)",fontWeight:"bold"}:{});function f(){i.value=!i.value}function g(e){const a=c.value?.action===e?"unchanged":e;l("set-pack-action",{pack_name:r.node.label,action:a})}function v(){"install"===c.value?.action?(l("set-pack-action",{pack_name:r.node.label,action:"unchanged"}),l("deselect-pack",r.node.label)):(l("set-pack-action",{pack_name:r.node.label,action:"install"}),l("select-pack",r.node.label))}function y(e){return mw.msg(e)}return(t,n)=>{const r=e.resolveComponent("tree-node",!0);return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["tree-node",{"is-pack":"pack"===o.node.type,"is-page":"page"===o.node.type}])},[e.createElementVNode("div",{class:"node-header",style:e.normalizeStyle({paddingLeft:24*o.depth+"px"})},[o.node.children&&o.node.children.length>0?(e.openBlock(),e.createElementBlock("button",{key:0,class:"expand-button",onClick:f},e.toDisplayString(i.value?"â–¼":"â–¶"),1)):(e.openBlock(),e.createElementBlock("span",R)),e.createElementVNode("div",A,[e.createElementVNode("div",P,[e.createElementVNode("span",L,e.toDisplayString("pack"===o.node.type?"ðŸ“¦":"ðŸ“„"),1),e.createElementVNode("strong",null,e.toDisplayString(o.node.label),1),o.node.version?(e.openBlock(),e.createElementBlock("span",T,"v"+e.toDisplayString(o.node.version),1)):e.createCommentVNode("v-if",!0),c.value?(e.openBlock(),e.createElementBlock("span",{key:1,class:e.normalizeClass(["node-status",d.value])},e.toDisplayString(p.value),3)):e.createCommentVNode("v-if",!0)]),o.node.description?(e.openBlock(),e.createElementBlock("div",U,e.toDisplayString(o.node.description),1)):e.createCommentVNode("v-if",!0),o.node.depends_on&&o.node.depends_on.length>0?(e.openBlock(),e.createElementBlock("div",I,[e.createElementVNode("small",null,e.toDisplayString(y("labkipackmanager-depends-on"))+": "+e.toDisplayString(o.node.depends_on.join(", ")),1)])):e.createCommentVNode("v-if",!0),"pack"===o.node.type?(e.openBlock(),e.createElementBlock("div",G,[e.createCommentVNode(" Install button: for packs not yet installed (current_version is null) "),c.value&&null===c.value.current_version?(e.openBlock(),e.createBlock(e.unref(a.CdxButton),{key:0,style:e.normalizeStyle(u.value),action:"progressive",onClick:v},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(y("labkipackmanager-select")),1)]),_:1},8,["style"])):e.createCommentVNode("v-if",!0),e.createCommentVNode(" Update button: for installed packs with newer version available "),s.value?(e.openBlock(),e.createBlock(e.unref(a.CdxButton),{key:1,style:e.normalizeStyle(m.value),onClick:n[0]||(n[0]=e=>g("update"))},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(y("labkipackmanager-update")),1)]),_:1},8,["style"])):e.createCommentVNode("v-if",!0),e.createCommentVNode(" Remove button: for installed packs "),c.value&&null!==c.value.current_version?(e.openBlock(),e.createBlock(e.unref(a.CdxButton),{key:2,style:e.normalizeStyle(k.value),action:"destructive",onClick:n[1]||(n[1]=e=>g("remove"))},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(y("labkipackmanager-remove")),1)]),_:1},8,["style"])):e.createCommentVNode("v-if",!0)])):e.createCommentVNode("v-if",!0)])],4),i.value&&o.node.children?(e.openBlock(),e.createElementBlock("div",j,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.node.children,a=>(e.openBlock(),e.createBlock(r,{key:a.id,node:a,depth:o.depth+1,onSelectPack:n[2]||(n[2]=e=>t.$emit("select-pack",e)),onDeselectPack:n[3]||(n[3]=e=>t.$emit("deselect-pack",e)),onSetPackAction:n[4]||(n[4]=e=>t.$emit("set-pack-action",e))},null,8,["node","depth"]))),128))])):e.createCommentVNode("v-if",!0)],2)}},__scopeId:"data-v-6225b7c8",__file:"resources/src/ui/TreeNode.vue"};const F={class:"hierarchy-tree-container"},H={key:0,class:"no-hierarchy"},z={key:1,class:"tree-content"},O={class:"tree-stats"},q={class:"tree-nodes"};var W={__name:"HierarchyTree",props:{hierarchy:Object},setup(a){async function o(e){await l("select_pack",{pack_name:e})}async function n(e){await l("deselect_pack",{pack_name:e})}function r(e){const a=t.packs[e.pack_name];a&&(a.action=e.action)}async function l(e,a){if(!t.busy)try{t.busy=!0;const o=await c({command:e,repo_url:t.repoUrl,ref:t.ref,data:a});E(t.packs,o.diff),t.stateHash=o.state_hash,t.warnings=o.warnings}catch(e){console.error("Command failed:",e)}finally{t.busy=!1}}function i(e){return mw.msg(e)}return(t,l)=>(e.openBlock(),e.createElementBlock("div",F,[e.createElementVNode("h3",null,e.toDisplayString(i("labkipackmanager-hierarchy-title")),1),a.hierarchy?(e.openBlock(),e.createElementBlock("div",z,[e.createElementVNode("div",O,[e.createElementVNode("span",null,e.toDisplayString(i("labkipackmanager-pack-count"))+": "+e.toDisplayString(a.hierarchy.meta.pack_count),1),e.createElementVNode("span",null,e.toDisplayString(i("labkipackmanager-page-count"))+": "+e.toDisplayString(a.hierarchy.meta.page_count),1)]),e.createElementVNode("div",q,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.hierarchy.root_nodes,a=>(e.openBlock(),e.createBlock($,{key:a.id,node:a,depth:0,onSelectPack:o,onDeselectPack:n,onSetPackAction:r},null,8,["node"]))),128))])])):(e.openBlock(),e.createElementBlock("div",H,[e.createElementVNode("p",null,e.toDisplayString(i("labkipackmanager-no-hierarchy-loaded")),1)]))]))},__scopeId:"data-v-adb05fca",__file:"resources/src/ui/HierarchyTree.vue"};const J={class:"details-panel"},Z={class:"panel-content"},K={key:0,class:"warnings-section"},Q={key:1,class:"selected-packs-section"},X={class:"packs-list"},Y={class:"pack-header"},ee={key:0,class:"pack-badge auto"},ae={key:1,class:"pack-badge manual"},te={class:"pack-details"},oe={key:0},ne={key:1},re={key:2},le={key:3},ie={key:2,class:"no-selection"},ce={key:3,class:"state-info"},se={class:"action-buttons"};var de={__name:"DetailsPanel",setup(o){const n=e.ref(""),r=e.ref(""),l=e.computed(()=>{const e=[];for(const[a,o]of Object.entries(t.packs))(o.selected||o.auto_selected)&&e.push({name:a,state:o,pageCount:Object.keys(o.pages||{}).length});return e});async function i(){if(!t.busy)try{t.busy=!0,n.value="",r.value="";const e=await c({command:"apply",repo_url:t.repoUrl,ref:t.ref,data:{}});E(t.packs,e.diff),t.stateHash=e.state_hash,t.warnings=e.warnings,e.operation?.operation_id?n.value=p("labkipackmanager-apply-success-with-id").replace("$1",e.operation.operation_id):n.value=p("labkipackmanager-apply-success")}catch(e){r.value=e instanceof Error?e.message:String(e)}finally{t.busy=!1}}async function s(){if(!t.busy)try{t.busy=!0,n.value="",r.value="";const e=await c({command:"refresh",repo_url:t.repoUrl,ref:t.ref,data:{}});E(t.packs,e.diff),t.stateHash=e.state_hash,t.warnings=e.warnings,n.value=p("labkipackmanager-refresh-success")}catch(e){r.value=e instanceof Error?e.message:String(e)}finally{t.busy=!1}}async function d(){if(!t.busy&&confirm(p("labkipackmanager-clear-confirm")))try{t.busy=!0,n.value="",r.value="";const e=await c({command:"clear",repo_url:t.repoUrl,ref:t.ref,data:{}});t.packs=e.diff,t.stateHash=e.state_hash,t.warnings=e.warnings,n.value=p("labkipackmanager-clear-success")}catch(e){r.value=e instanceof Error?e.message:String(e)}finally{t.busy=!1}}function p(e){return mw.msg(e)}return(o,c)=>(e.openBlock(),e.createElementBlock("div",J,[e.createElementVNode("h3",null,e.toDisplayString(p("labkipackmanager-details-title")),1),e.createElementVNode("div",Z,[e.createCommentVNode(" Warnings Section "),e.unref(t).warnings.length>0?(e.openBlock(),e.createElementBlock("div",K,[e.createElementVNode("h4",null,e.toDisplayString(p("labkipackmanager-warnings")),1),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(t).warnings,(t,o)=>(e.openBlock(),e.createBlock(e.unref(a.CdxMessage),{key:o,type:"warning",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t),1)]),_:2},1024))),128))])):e.createCommentVNode("v-if",!0),e.createCommentVNode(" Selected Packs Section "),l.value.length>0?(e.openBlock(),e.createElementBlock("div",Q,[e.createElementVNode("h4",null,e.toDisplayString(p("labkipackmanager-selected-packs")),1),e.createElementVNode("div",X,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,a=>(e.openBlock(),e.createElementBlock("div",{key:a.name,class:"pack-item"},[e.createElementVNode("div",Y,[e.createElementVNode("strong",null,e.toDisplayString(a.name),1),a.state.auto_selected?(e.openBlock(),e.createElementBlock("span",ee,e.toDisplayString(p("labkipackmanager-auto-selected")),1)):(e.openBlock(),e.createElementBlock("span",ae,e.toDisplayString(p("labkipackmanager-manually-selected")),1))]),e.createElementVNode("div",te,[a.state.action?(e.openBlock(),e.createElementBlock("div",oe,[e.createElementVNode("small",null,e.toDisplayString(p("labkipackmanager-action"))+": "+e.toDisplayString(a.state.action),1)])):e.createCommentVNode("v-if",!0),a.state.target_version?(e.openBlock(),e.createElementBlock("div",ne,[e.createElementVNode("small",null,e.toDisplayString(p("labkipackmanager-version"))+": "+e.toDisplayString(a.state.target_version),1)])):e.createCommentVNode("v-if",!0),a.state.prefix?(e.openBlock(),e.createElementBlock("div",re,[e.createElementVNode("small",null,e.toDisplayString(p("labkipackmanager-prefix"))+": "+e.toDisplayString(a.state.prefix),1)])):e.createCommentVNode("v-if",!0),a.pageCount>0?(e.openBlock(),e.createElementBlock("div",le,[e.createElementVNode("small",null,e.toDisplayString(p("labkipackmanager-pages"))+": "+e.toDisplayString(a.pageCount),1)])):e.createCommentVNode("v-if",!0)])]))),128))])])):(e.openBlock(),e.createElementBlock("div",ie,[e.createElementVNode("p",null,e.toDisplayString(p("labkipackmanager-no-packs-selected")),1)])),e.createCommentVNode(" State Hash (Debug) "),e.unref(t).stateHash?(e.openBlock(),e.createElementBlock("div",ce,[e.createElementVNode("small",null,[e.createTextVNode(e.toDisplayString(p("labkipackmanager-state-hash"))+": ",1),e.createElementVNode("code",null,e.toDisplayString(e.unref(t).stateHash),1)])])):e.createCommentVNode("v-if",!0),e.createCommentVNode(" Action Buttons "),e.createElementVNode("div",se,[e.createVNode(e.unref(a.CdxButton),{action:"progressive",weight:"primary",disabled:e.unref(t).busy||0===l.value.length,onClick:i},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(p("labkipackmanager-apply")),1)]),_:1},8,["disabled"]),e.createVNode(e.unref(a.CdxButton),{action:"default",disabled:e.unref(t).busy,onClick:s},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(p("labkipackmanager-refresh")),1)]),_:1},8,["disabled"]),e.createVNode(e.unref(a.CdxButton),{action:"destructive",weight:"quiet",disabled:e.unref(t).busy,onClick:d},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(p("labkipackmanager-clear")),1)]),_:1},8,["disabled"])]),e.createCommentVNode(" Operation Status "),n.value?(e.openBlock(),e.createBlock(e.unref(a.CdxMessage),{key:4,type:"success",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(n.value),1)]),_:1})):e.createCommentVNode("v-if",!0),r.value?(e.openBlock(),e.createBlock(e.unref(a.CdxMessage),{key:5,type:"error",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(r.value),1)]),_:1})):e.createCommentVNode("v-if",!0)])]))},__scopeId:"data-v-348c6e2c",__file:"resources/src/ui/DetailsPanel.vue"};const pe={class:"labki-pack-manager-app"},ue={class:"app-header"},me={class:"app-description"},ke={key:0,class:"loading-overlay"},fe={class:"loading-spinner"},ge={class:"app-main"};var ve={__name:"App",setup(a){function o(e){return mw.msg(e)}return e.onMounted(()=>{console.log("Labki Pack Manager initialized")}),(a,n)=>(e.openBlock(),e.createElementBlock("div",pe,[e.createElementVNode("header",ue,[e.createElementVNode("h1",null,e.toDisplayString(o("labkipackmanager-special-title")),1),e.createElementVNode("p",me,e.toDisplayString(o("labkipackmanager-special-description")),1)]),e.unref(t).busy?(e.openBlock(),e.createElementBlock("div",ke,[e.createElementVNode("div",fe,e.toDisplayString(o("labkipackmanager-loading"))+"... ",1)])):e.createCommentVNode("v-if",!0),e.createElementVNode("main",ge,[e.createVNode(_),e.unref(t).repoUrl&&e.unref(t).ref?(e.openBlock(),e.createBlock(C,{key:0,"mermaid-src":e.unref(t).mermaidSrc},null,8,["mermaid-src"])):e.createCommentVNode("v-if",!0),e.unref(t).repoUrl&&e.unref(t).ref?(e.openBlock(),e.createBlock(W,{key:1,hierarchy:e.unref(t).hierarchy},null,8,["hierarchy"])):e.createCommentVNode("v-if",!0),e.unref(t).repoUrl&&e.unref(t).ref?(e.openBlock(),e.createBlock(de,{key:2})):e.createCommentVNode("v-if",!0)])]))}};ve.__scopeId="data-v-23151fc9",ve.__file="resources/src/ui/App.vue",console.log("Labki Pack Manager: main.ts loading..."),console.log("Labki Pack Manager: imports complete"),console.log("Labki Pack Manager: Checking MediaWiki environment..."),"undefined"!=typeof mw&&mw.loader?(console.log("Labki Pack Manager: MediaWiki environment available, starting bootstrap"),console.log("Labki Pack Manager: bootstrap called"),mw.loader.using(["vue","mediawiki.api","@wikimedia/codex","codex-styles"]).then(()=>{console.log("Labki Pack Manager: All modules loaded, initializing app"),function(){console.log("Labki Pack Manager: initApp called");const a=document.getElementById("labki-pack-manager-root");a?(console.log("Labki Pack Manager: Root element found, creating app"),e.createApp(ve).mount(a),console.log("Labki Pack Manager: Application mounted")):console.error("Labki Pack Manager: Root element not found")}()}).catch(e=>{console.error("Labki Pack Manager: Failed to load required modules",e)})):console.error("Labki Pack Manager: MediaWiki environment not available")}(Vue,Codex);
//# sourceMappingURL=app.bundle.js.map
