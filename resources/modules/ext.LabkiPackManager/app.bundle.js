var Vue="undefined"!=typeof mw&&mw.loader&&mw.loader.require?mw.loader.require("vue"):window.Vue,Codex="undefined"!=typeof mw&&mw.loader&&mw.loader.require?mw.loader.require("@wikimedia/codex")||mw.loader.require("codex"):window.Codex,mermaid=function(){try{if("undefined"!=typeof window&&window.mermaid)return window.mermaid;if("undefined"!=typeof mw&&mw.loader&&mw.loader.require){var e=mw.loader.require("ext.mermaid");if(e?.initialize)return e;if(e?.mermaid?.initialize)return e.mermaid;if(e?.default?.initialize)return e.default}}catch(e){}return window.mermaid}();!function(e,a){"use strict";const t=e.reactive({repoUrl:"",ref:"",mermaidSrc:"",hierarchy:null,packs:{},stateHash:"",warnings:[],busy:!1,selectedRepo:null,repos:[]});function n(){return new mw.Api}async function o(e){try{return await e()}catch(e){throw console.error("API call failed:",e),e}}async function l(e,a){return o(async()=>{const t=n();return(await t.post({action:"labkiReposAdd",format:"json",repo_url:e,default_ref:a})).labkiReposAdd})}async function r(e,a){return o(async()=>{const t=n(),o=await t.get({action:"labkiGraphGet",format:"json",repo_url:e,ref:a});console.log("[graphGet] Response:",o);let l=o.labkiGraphGet;if(!l){if(!(o.graph&&o.repo_url&&o.ref))throw new Error("Invalid graphGet response structure");console.log("[graphGet] Using unwrapped response"),l=o}return l})}async function i(e,a){return o(async()=>{const t=n(),o=await t.get({action:"labkiHierarchyGet",format:"json",repo_url:e,ref:a});console.log("[hierarchyGet] Response:",o);let l=o.labkiHierarchyGet;if(!l){if(!(o.hierarchy&&o.repo_url&&o.ref))throw new Error("Invalid hierarchyGet response structure");console.log("[hierarchyGet] Using unwrapped response"),l=o}return l})}async function c(e){return o(async()=>{const a=n();console.log("[packsAction] Sending payload:",e);const t=await a.post({action:"labkiPacksAction",format:"json",payload:JSON.stringify(e)});console.log("[packsAction] Raw response:",t);let o=t.labkiPacksAction;if(!o)throw console.error("[packsAction] Cannot find labkiPacksAction in response:",JSON.stringify(t,null,2)),new Error("Invalid packsAction response structure");return console.log("[packsAction] Returning:",o),o})}const s={class:"add-repo-form"},d={class:"error"};var u={__name:"AddRepoModal",props:{modelValue:Boolean},emits:["update:modelValue","added"],setup(t,{emit:n}){const o=t,r=n,i=e.computed({get:()=>o.modelValue,set:e=>r("update:modelValue",e)}),c=e.ref(""),u=e.ref("main"),p=e.ref(""),m=e.ref(""),f=e.ref(!1),k=e.computed(()=>""!==c.value.trim()&&""!==u.value.trim()&&!p.value);function g(){p.value="";const e=c.value.trim();if(e)try{new URL(e),e.match(/^(https?|git|ssh):\/\//)||(p.value=mw.msg("labkipackmanager-error-invalid-protocol"))}catch{p.value=mw.msg("labkipackmanager-error-invalid-url")}}async function v(){if(k.value&&!f.value){f.value=!0,m.value="";try{await l(c.value.trim(),u.value.trim()),r("added",c.value.trim()),y()}catch(e){m.value=e instanceof Error?e.message:String(e)}finally{f.value=!1}}}function y(){c.value="",u.value="main",p.value="",m.value="",i.value=!1}function h(e){return mw.msg(e)}return(t,n)=>(e.openBlock(),e.createBlock(e.unref(a.CdxDialog),{open:i.value,"onUpdate:open":n[2]||(n[2]=e=>i.value=e),title:h("labkipackmanager-add-repo-title"),"primary-action":{label:h("labkipackmanager-add-repo-submit"),actionType:"progressive",disabled:f.value||!k.value},"default-action":{label:h("labkipackmanager-cancel")},onPrimary:v,onDefault:y},{default:e.withCtx(()=>[e.createElementVNode("div",s,[e.createVNode(e.unref(a.CdxField),{"is-fieldset":!1},e.createSlots({label:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(h("labkipackmanager-repo-url-label")),1)]),default:e.withCtx(()=>[e.createVNode(e.unref(a.CdxTextInput),{modelValue:c.value,"onUpdate:modelValue":[n[0]||(n[0]=e=>c.value=e),g],placeholder:h("labkipackmanager-repo-url-placeholder"),disabled:f.value},null,8,["modelValue","placeholder","disabled"])]),_:2},[p.value?{name:"help-text",fn:e.withCtx(()=>[e.createElementVNode("span",d,e.toDisplayString(p.value),1)]),key:"0"}:void 0]),1024),e.createVNode(e.unref(a.CdxField),{"is-fieldset":!1},{label:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(h("labkipackmanager-default-ref-label")),1)]),default:e.withCtx(()=>[e.createVNode(e.unref(a.CdxTextInput),{modelValue:u.value,"onUpdate:modelValue":n[1]||(n[1]=e=>u.value=e),placeholder:h("labkipackmanager-default-ref-placeholder"),disabled:f.value},null,8,["modelValue","placeholder","disabled"])]),_:1}),m.value?(e.openBlock(),e.createBlock(e.unref(a.CdxMessage),{key:0,type:"error",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(m.value),1)]),_:1})):e.createCommentVNode("v-if",!0)])]),_:1},8,["open","title","primary-action","default-action"]))},__scopeId:"data-v-0cf6aec2",__file:"resources/src/ui/AddRepoModal.vue"};const p={class:"add-ref-form"},m={class:"repo-info"};var f={__name:"AddRefModal",props:{modelValue:Boolean,repoUrl:String},emits:["update:modelValue","added"],setup(t,{emit:n}){const o=t,r=n,i=e.computed({get:()=>o.modelValue,set:e=>r("update:modelValue",e)}),c=e.ref(""),s=e.ref(""),d=e.ref(!1),u=e.computed(()=>""!==c.value.trim());async function f(){if(u.value&&!d.value){d.value=!0,s.value="";try{await l(o.repoUrl,c.value.trim()),r("added",c.value.trim()),k()}catch(e){s.value=e instanceof Error?e.message:String(e)}finally{d.value=!1}}}function k(){c.value="",s.value="",i.value=!1}function g(e){return mw.msg(e)}return(n,o)=>(e.openBlock(),e.createBlock(e.unref(a.CdxDialog),{open:i.value,"onUpdate:open":o[1]||(o[1]=e=>i.value=e),title:g("labkipackmanager-add-ref-title"),"primary-action":{label:g("labkipackmanager-add-ref-submit"),actionType:"progressive",disabled:d.value||!u.value},"default-action":{label:g("labkipackmanager-cancel")},onPrimary:f,onDefault:k},{default:e.withCtx(()=>[e.createElementVNode("div",p,[e.createElementVNode("p",m,[e.createElementVNode("strong",null,e.toDisplayString(g("labkipackmanager-repository"))+":",1),e.createTextVNode(" "+e.toDisplayString(t.repoUrl),1)]),e.createVNode(e.unref(a.CdxField),{"is-fieldset":!1},{label:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(g("labkipackmanager-ref-name-label")),1)]),default:e.withCtx(()=>[e.createVNode(e.unref(a.CdxTextInput),{modelValue:c.value,"onUpdate:modelValue":o[0]||(o[0]=e=>c.value=e),placeholder:g("labkipackmanager-ref-name-placeholder"),disabled:d.value},null,8,["modelValue","placeholder","disabled"])]),_:1}),s.value?(e.openBlock(),e.createBlock(e.unref(a.CdxMessage),{key:0,type:"error",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(s.value),1)]),_:1})):e.createCommentVNode("v-if",!0)])]),_:1},8,["open","title","primary-action","default-action"]))},__scopeId:"data-v-f029ab7a",__file:"resources/src/ui/AddRefModal.vue"};const k={class:"repo-ref-selector"},g={class:"selector-row",style:{display:"flex",gap:"24px","flex-wrap":"nowrap"}},v={class:"selector-field",style:{flex:"1 1 0","min-width":"0"}},y={class:"selector-field",style:{flex:"1 1 0","min-width":"0"}},h={key:0,class:"current-selection"},b="__add_new_repo__",w="__add_new_ref__";var _={__name:"RepoRefSelector",setup(l){const s=e.ref(""),d=e.ref(""),p=e.ref(!1),m=e.ref(!1),_=e.ref(""),V=e.computed(()=>{if(console.log("Computing repoMenuItems, store.repos:",t.repos),!t.repos||0===t.repos.length)return[{label:"Loading...",value:"",disabled:!0}];const e=t.repos.map(e=>({label:e.repo_url,value:e.repo_url}));return e.push({label:"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",value:"__separator__",disabled:!0}),e.push({label:A("labkipackmanager-add-repo-option"),value:b}),e}),N=e.computed(()=>{if(!t.selectedRepo)return[];const e=t.selectedRepo.refs.map(e=>({label:`${e.ref_name} ${e.is_default?"(default)":""}`,value:e.ref}));return e.push({label:"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€",value:"__separator__",disabled:!0}),e.push({label:A("labkipackmanager-add-ref-option"),value:w}),e});async function C(){try{console.log("[loadRepos] Starting..."),t.busy=!0,_.value="",console.log("[loadRepos] Calling reposList API...");const e=await async function(){return o(async()=>{console.log("[reposList] Starting API call...");const e=n();console.log("[reposList] API instance:",e);const a=await e.get({action:"labkiReposList",format:"json"});if(console.log("[reposList] Raw API response:",a),console.log("[reposList] Response keys:",Object.keys(a)),!a)throw new Error("No response from API");let t=a.labkiReposList;if(!t){if(!a.repos||!a.meta)throw console.error("[reposList] Cannot find repos data in response:",JSON.stringify(a,null,2)),new Error("Invalid API response structure - no labkiReposList field and no repos field");console.log("[reposList] Response appears to be unwrapped, using directly"),t=a}return console.log("[reposList] Data structure:",t),console.log("[reposList] Returning:",t),t})}();if(console.log("[loadRepos] API response received:",e),!e)throw new Error("No response from reposList API");if(!e.repos)throw new Error("Invalid response structure - no repos field. Response: "+JSON.stringify(e));console.log("[loadRepos] Setting store.repos:",e.repos),t.repos=e.repos,console.log("[loadRepos] store.repos is now:",t.repos),console.log("[loadRepos] store.repos.length:",t.repos.length),t.repos.length>0&&!s.value&&(console.log("[loadRepos] Auto-selecting first repo:",t.repos[0].repo_url),await S(t.repos[0].repo_url))}catch(e){console.error("[loadRepos] Error:",e),_.value=e instanceof Error?e.message:String(e)}finally{t.busy=!1,console.log("[loadRepos] Finished. store.busy:",t.busy,"store.repos:",t.repos)}}async function B(e){if(e===b)return p.value=!0,void(s.value=t.repoUrl);"string"==typeof e&&e&&"__separator__"!==e&&await S(e)}async function S(e){try{t.busy=!0,_.value="",s.value=e,t.repoUrl=e;const a=t.repos.find(a=>a.repo_url===e);if(!a)throw new Error(A("labkipackmanager-error-repo-not-found"));t.selectedRepo=a;const n=a.refs.find(e=>e.is_default),o=n?.ref||a.refs[0]?.ref;o&&await x(o)}catch(e){_.value=e instanceof Error?e.message:String(e)}finally{t.busy=!1}}async function E(e){if(e===w)return m.value=!0,void(d.value=t.ref);"string"==typeof e&&e&&"__separator__"!==e&&await x(e)}async function x(e){try{t.busy=!0,_.value="",d.value=e,t.ref=e,t.packs={},t.warnings=[];const[a,n]=await Promise.all([r(t.repoUrl,t.ref),i(t.repoUrl,t.ref)]);t.mermaidSrc=function(e){const a=["graph TD"],t=new Set,n=[];for(const a of e.containsEdges||[])t.add(a.from),t.add(a.to),n.push({from:a.from,to:a.to,type:"contains"});for(const a of e.dependsEdges||[])t.add(a.from),t.add(a.to),n.push({from:a.from,to:a.to,type:"depends"});for(const e of t){const t=T(e),[n,...o]=e.split(":"),l=o.join(":"),r="page"===n?"ðŸ“„":"ðŸ“¦";a.push(`  ${t}["${r} ${l}"]`)}for(const e of n){const t=T(e.from),n=T(e.to);"depends"===e.type?a.push(`  ${t} -.-> ${n}`):a.push(`  ${t} --\x3e ${n}`)}const o=a.join("\n");return console.log("[buildMermaidFromGraph] Generated Mermaid syntax:\n",o),o}(a.graph),t.hierarchy=n.hierarchy;const o=await c({command:"init",repo_url:t.repoUrl,ref:t.ref,data:{}});t.packs=o.diff,t.stateHash=o.state_hash,t.warnings=o.warnings}catch(e){_.value=e instanceof Error?e.message:String(e)}finally{t.busy=!1}}async function D(e){await C(),await S(e)}async function M(e){s.value&&(await C(),await x(e))}function T(e){return e.replace(/[^a-zA-Z0-9_]/g,"_")}function A(e){return mw.msg(e)}return e.onMounted(async()=>{console.log("RepoRefSelector mounted, store:",t),await C()}),(n,o)=>(e.openBlock(),e.createElementBlock("div",k,[e.createElementVNode("h2",null,e.toDisplayString(A("labkipackmanager-select-source")),1),e.createElementVNode("div",g,[e.createElementVNode("div",v,[e.createVNode(e.unref(a.CdxField),null,{label:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(A("labkipackmanager-repo-selector-label")),1)]),default:e.withCtx(()=>[e.createVNode(e.unref(a.CdxSelect),{selected:s.value,"onUpdate:selected":[o[0]||(o[0]=e=>s.value=e),B],"menu-items":V.value,disabled:e.unref(t).busy},null,8,["selected","menu-items","disabled"])]),_:1})]),e.createElementVNode("div",y,[e.createVNode(e.unref(a.CdxField),null,{label:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(A("labkipackmanager-ref-selector-label")),1)]),default:e.withCtx(()=>[e.createVNode(e.unref(a.CdxSelect),{selected:d.value,"onUpdate:selected":[o[1]||(o[1]=e=>d.value=e),E],"menu-items":N.value,disabled:e.unref(t).busy||!s.value},null,8,["selected","menu-items","disabled"])]),_:1})])]),s.value&&d.value?(e.openBlock(),e.createElementBlock("div",h,[e.createElementVNode("strong",null,e.toDisplayString(A("labkipackmanager-current-selection"))+":",1),e.createTextVNode(" "+e.toDisplayString(s.value)+" @ "+e.toDisplayString(d.value),1)])):e.createCommentVNode("v-if",!0),_.value?(e.openBlock(),e.createBlock(e.unref(a.CdxMessage),{key:1,type:"error",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(_.value),1)]),_:1})):e.createCommentVNode("v-if",!0),e.createVNode(u,{modelValue:p.value,"onUpdate:modelValue":o[2]||(o[2]=e=>p.value=e),onAdded:D},null,8,["modelValue"]),e.createVNode(f,{modelValue:m.value,"onUpdate:modelValue":o[3]||(o[3]=e=>m.value=e),"repo-url":s.value,onAdded:M},null,8,["modelValue","repo-url"])]))},__scopeId:"data-v-a9c77630",__file:"resources/src/ui/RepoRefSelector.vue"};const V={class:"mermaid-graph-container"},N={key:0,class:"no-mermaid-message"},C={key:1,class:"mermaid-wrapper"},B={key:2,class:"no-graph-message"};var S={__name:"MermaidGraph",props:{mermaidSrc:String},setup(t){const n=t,o=e.ref(!1),l=e.ref(null);function r(e){return mw.msg(e)}return e.onMounted(()=>{!function(){const e=mw.loader.getState("ext.mermaid");o.value="ready"===e||"loaded"===e||"loading"===e,o.value?console.log("[MermaidGraph] Mermaid extension is available, state:",e):console.warn("Mermaid extension is not available")}()}),e.watch(()=>n.mermaidSrc,async()=>{o.value&&n.mermaidSrc&&(await e.nextTick(),function(){if(console.log("[MermaidGraph] Triggering Mermaid render"),"undefined"!=typeof window&&window.mermaid)try{if("function"==typeof window.mermaid.initialize&&(console.log("[MermaidGraph] Calling mermaid.initialize()"),window.mermaid.initialize({startOnLoad:!1,theme:"forest",securityLevel:"loose"})),l.value){const e=l.value.querySelectorAll("svg");e.forEach(e=>e.remove()),console.log("[MermaidGraph] Removed",e.length,"existing SVG(s)"),l.value.innerHTML=n.mermaidSrc,l.value.removeAttribute("data-processed")}setTimeout(()=>{console.log("[MermaidGraph] Attempting to render mermaid diagrams"),"function"==typeof window.mermaid.run?(window.mermaid.run(),console.log("[MermaidGraph] Called mermaid.run()")):"function"==typeof window.mermaid.contentLoaded&&(window.mermaid.contentLoaded(),console.log("[MermaidGraph] Called mermaid.contentLoaded()"))},100)}catch(e){console.error("[MermaidGraph] Failed to trigger mermaid render:",e)}else console.warn("[MermaidGraph] window.mermaid not available")}())}),(n,i)=>(e.openBlock(),e.createElementBlock("div",V,[e.createElementVNode("h3",null,e.toDisplayString(r("labkipackmanager-graph-title")),1),o.value?t.mermaidSrc?(e.openBlock(),e.createElementBlock("div",C,[e.createElementVNode("pre",{class:"mermaid",ref_key:"mermaidPre",ref:l},e.toDisplayString(t.mermaidSrc),513)])):(e.openBlock(),e.createElementBlock("div",B,[e.createElementVNode("p",null,e.toDisplayString(r("labkipackmanager-no-graph-loaded")),1)])):(e.openBlock(),e.createElementBlock("div",N,[e.createVNode(e.unref(a.CdxMessage),{type:"warning",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(r("labkipackmanager-mermaid-not-installed")),1)]),_:1})]))]))}};function E(e,a){for(const[t,n]of Object.entries(a)){const a=e[t]??{};e[t]=x(a,n)}}function x(e,a){const t={...e,...a};if(a.pages){t.pages={...e.pages??{}};for(const[e,n]of Object.entries(a.pages)){const a=t.pages[e]??{};t.pages[e]=D(a,n)}}return t}function D(e,a){return{...e,...a}}S.__scopeId="data-v-04226ecd",S.__file="resources/src/ui/MermaidGraph.vue";const M={class:"labki-tree"},T=["data-type","data-action"],A=["aria-expanded","aria-label"],P={key:1,class:"toggle-spacer","aria-hidden":"true"},R={class:"node-icon","aria-hidden":"true"},L={class:"main"},U={class:"title-line"},I=["title"],G={key:0,class:"badge version"},$=["title"],z={key:2,class:"badge update"},H={key:0,class:"desc"},j={key:1,class:"depends"},q={class:"inline-label"},F=["value","placeholder","disabled","readonly"],O={class:"inline-label"},W={class:"page-editor"},J=["title"],Z=["value","placeholder","disabled","readonly","aria-invalid","aria-describedby"],K=["id","title"],Q={key:2,class:"actions"},X={key:0,class:"action-item"},Y={key:1,class:"action-item"},ee={key:2,class:"action-item"};var ae={__name:"TreeNode",props:{node:{type:Object,required:!0},depth:{type:Number,required:!0},parentPackName:{type:String,default:null}},emits:["set-pack-action"],setup(n,{emit:o}){const l=n,r=o,i=e.ref(!1);let s=null,d=null;const u=e.computed(()=>!(!l.node.children||!l.node.children.length)),p=e.computed(()=>"pack"===l.node.type&&t.packs[l.node.label]||null);e.computed(()=>{const e=p.value?.action;return e&&"unchanged"!==e});const m=e.computed(()=>{const e=p.value?.action,a=p.value?.installed;return"install"===e&&!a}),f=e.computed(()=>{const e=p.value?.action,a=p.value?.installed;return"install"===e||"update"===e||a}),k=e.computed(()=>p.value?.prefix||""),g=e.computed(()=>"pack"===l.node.type?l.node.label:null),v=e.computed(()=>"page"===l.node.type&&l.parentPackName||null),y=e.computed(()=>v.value&&t.packs[v.value]||null),h=e.computed(()=>y.value?.pages&&y.value.pages[l.node.label]||null);e.computed(()=>{const e=y.value?.action;return"install"===e||"update"===e});const b=e.computed(()=>{const e=y.value?.action,a=h.value?.installed;return"install"===e&&!a}),w=e.computed(()=>{const e=y.value?.action,a=h.value?.installed;return"install"===e||"update"===e||a}),_=e.computed(()=>y.value?.prefix||""),V=e.computed(()=>_.value?_.value.endsWith("/")?_.value:_.value+"/":""),N=e.computed(()=>{const e=h.value?.final_title||"",a=V.value;return a&&e.startsWith(a)?e.slice(a.length):e}),C=e.computed(()=>{const e=h.value?.final_title;return!(!e||!v.value)&&t.warnings.some(a=>a.includes(e)&&a.includes(v.value))}),B=e.computed(()=>{const e=h.value?.final_title;return e&&v.value?t.warnings.filter(a=>a.includes(e)&&a.includes(v.value)).join("\n"):""}),S=e.computed(()=>`collision-${v.value||"none"}-${l.node.label}`),x=e.computed(()=>{const e=p.value;return!!e&&(null!==e.current_version&&(!!e.target_version&&e.target_version>e.current_version))});"pack"===l.node.type&&e.watch(()=>p.value?.action,(e,a)=>{console.log(`[TreeNode:${l.node.label}] packState.action changed: "${a}" -> "${e}"`)});const D=e.computed(()=>{t.stateHash;const e=a=>{if("pack"===a.type){const e=t.packs[a.label];if(e&&e.action&&"unchanged"!==e.action)return!0}if(!a.children)return!1;for(const t of a.children)if(e(t))return!0;return!1};return e(l.node)});function ae(){i.value=!i.value}function te(e){const a=p.value?.action,t=a===e?"unchanged":e;console.log(`[TreeNode:${l.node.label}] toggleAction: current="${a}", requested="${e}", next="${t}"`),console.log(`[TreeNode:${l.node.label}] packState:`,p.value),r("set-pack-action",{pack_name:l.node.label,action:t})}function ne(){te("install")}function oe(){te("remove")}function le(){te("update")}function re(e){if(!m.value)return;const a=e.target.value;s&&clearTimeout(s),s=setTimeout(()=>async function(e){if(t.busy)return;try{t.busy=!0;const a=await c({command:"set_pack_prefix",repo_url:t.repoUrl,ref:t.ref,data:{pack_name:l.node.label,prefix:e}});E(t.packs,a.diff),t.stateHash=a.state_hash,t.warnings=a.warnings}catch(e){console.error("set_pack_prefix failed:",e)}finally{t.busy=!1}}(a),400)}function ie(e){if(!b.value)return;const a=e.target.value;d&&clearTimeout(d),d=setTimeout(()=>{!async function(e){if(t.busy||!v.value)return;try{t.busy=!0;const a=await c({command:"rename_page",repo_url:t.repoUrl,ref:t.ref,data:{pack_name:v.value,page_name:l.node.label,new_title:e}});E(t.packs,a.diff),t.stateHash=a.state_hash,t.warnings=a.warnings}catch(e){console.error("rename_page failed:",e)}finally{t.busy=!1}}(V.value?V.value+a:a)},400)}function ce(e){return mw.msg(e)}i.value=l.depth<2||D.value,e.onBeforeUnmount(()=>{s&&clearTimeout(s),d&&clearTimeout(d)});const se=e.computed(()=>{if(!l.node.children)return[];const e=[...l.node.children],a=e=>(e||"").toLocaleLowerCase();return e.sort((e,t)=>{if("page"===e.type&&"page"!==t.type)return-1;if("page"!==e.type&&"page"===t.type)return 1;const n=a(e.label),o=a(t.label);return n<o?-1:n>o?1:0}),e});return(t,o)=>{const l=e.resolveComponent("tree-node",!0);return e.openBlock(),e.createElementBlock("div",M,[e.createElementVNode("div",{class:"tree-node","data-type":n.node.type,"data-action":p.value?.action||"unchanged",style:e.normalizeStyle({marginLeft:1.5*n.depth+"rem"})},[e.createElementVNode("div",{class:"node-row",style:e.normalizeStyle({"--indent":n.depth})},[e.createCommentVNode(" Toggle "),u.value?(e.openBlock(),e.createElementBlock("button",{key:0,class:"toggle","aria-expanded":i.value.toString(),"aria-label":i.value?ce("labkipackmanager-collapse"):ce("labkipackmanager-expand"),onClick:ae},e.toDisplayString(i.value?"â–¼":"â–¶"),9,A)):(e.openBlock(),e.createElementBlock("span",P)),e.createCommentVNode(" Icon "),e.createElementVNode("span",R,e.toDisplayString("pack"===n.node.type?"ðŸ“¦":"ðŸ“„"),1),e.createCommentVNode(" Main "),e.createElementVNode("div",L,[e.createElementVNode("div",U,[e.createElementVNode("strong",{class:"label",title:n.node.label},e.toDisplayString(n.node.label),9,I),n.node.version?(e.openBlock(),e.createElementBlock("span",G,"v"+e.toDisplayString(n.node.version),1)):e.createCommentVNode("v-if",!0),p.value&&p.value.action&&"unchanged"!==p.value.action?(e.openBlock(),e.createElementBlock("span",{key:1,class:e.normalizeClass(["badge",p.value.auto_selected_reason?"auto":"manual"]),title:p.value.auto_selected_reason||""},e.toDisplayString(p.value.auto_selected_reason?ce("labkipackmanager-auto-selected"):ce("labkipackmanager-manually-selected")),11,$)):e.createCommentVNode("v-if",!0),x.value?(e.openBlock(),e.createElementBlock("span",z,e.toDisplayString(ce("labkipackmanager-update-available")),1)):e.createCommentVNode("v-if",!0)]),n.node.description?(e.openBlock(),e.createElementBlock("div",H,e.toDisplayString(n.node.description),1)):e.createCommentVNode("v-if",!0),n.node.depends_on?.length?(e.openBlock(),e.createElementBlock("div",j,[e.createElementVNode("small",null,e.toDisplayString(ce("labkipackmanager-depends-on"))+": "+e.toDisplayString(n.node.depends_on.join(", ")),1)])):e.createCommentVNode("v-if",!0),e.createCommentVNode(" Pack prefix editor "),"pack"===n.node.type&&f.value?(e.openBlock(),e.createElementBlock("div",{key:2,class:e.normalizeClass(["inline-editor pack",{readonly:!m.value}])},[e.createElementVNode("label",q,e.toDisplayString(ce("labkipackmanager-pack-prefix")),1),e.createElementVNode("input",{class:"input",type:"text",value:k.value,placeholder:ce("labkipackmanager-pack-prefix-placeholder")||"MyNamespace/MyPack",disabled:!m.value,readonly:!m.value,onInput:re},null,40,F)],2)):e.createCommentVNode("v-if",!0),e.createCommentVNode(" Page title editor "),"page"===n.node.type&&w.value?(e.openBlock(),e.createElementBlock("div",{key:3,class:e.normalizeClass(["inline-editor page",{readonly:!b.value}])},[e.createElementVNode("label",O,e.toDisplayString(ce("labkipackmanager-page-title")),1),e.createElementVNode("div",W,[_.value?(e.openBlock(),e.createElementBlock("span",{key:0,class:"prefix-chip",title:V.value},e.toDisplayString(V.value),9,J)):e.createCommentVNode("v-if",!0),e.createElementVNode("input",{class:e.normalizeClass(["input page-title",{"has-collision":C.value}]),type:"text",value:N.value,placeholder:ce("labkipackmanager-page-title-placeholder")||"PageTitle",disabled:!b.value,readonly:!b.value,onInput:ie,"aria-invalid":C.value?"true":"false","aria-describedby":C.value?S.value:void 0},null,42,Z),C.value?(e.openBlock(),e.createElementBlock("span",{key:1,class:"collision",id:S.value,title:B.value,"aria-live":"polite"},"âš ï¸",8,K)):e.createCommentVNode("v-if",!0)])],2)):e.createCommentVNode("v-if",!0)]),e.createCommentVNode(" Actions "),"pack"===n.node.type?(e.openBlock(),e.createElementBlock("div",Q,[p.value&&null===p.value.current_version?(e.openBlock(),e.createElementBlock("div",X,[e.createVNode(e.unref(a.CdxButton),{action:"progressive",class:e.normalizeClass({active:"install"===p.value.action}),onClick:ne},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(ce("labkipackmanager-select")),1)]),_:1},8,["class"])])):e.createCommentVNode("v-if",!0),x.value?(e.openBlock(),e.createElementBlock("div",Y,[e.createVNode(e.unref(a.CdxButton),{class:e.normalizeClass({active:"update"===p.value?.action}),onClick:le},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(ce("labkipackmanager-update")),1)]),_:1},8,["class"])])):e.createCommentVNode("v-if",!0),p.value&&null!==p.value.current_version?(e.openBlock(),e.createElementBlock("div",ee,[e.createVNode(e.unref(a.CdxButton),{action:"destructive",class:e.normalizeClass({active:"remove"===p.value.action}),onClick:oe},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(ce("labkipackmanager-remove")),1)]),_:1},8,["class"])])):e.createCommentVNode("v-if",!0)])):e.createCommentVNode("v-if",!0)],4),i.value&&u.value?(e.openBlock(),e.createBlock(e.TransitionGroup,{key:0,name:"children",tag:"div",class:"children"},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(se.value,a=>(e.openBlock(),e.createBlock(l,{key:a.id,node:a,depth:n.depth+1,"parent-pack-name":g.value,onSetPackAction:o[0]||(o[0]=e=>t.$emit("set-pack-action",e))},null,8,["node","depth","parent-pack-name"]))),128))]),_:1})):e.createCommentVNode("v-if",!0)],12,T)])}},__scopeId:"data-v-6225b7c8",__file:"resources/src/ui/TreeNode.vue"};const te={class:"hierarchy-tree-container"},ne={key:0,class:"no-hierarchy"},oe={key:1,class:"tree-content"},le={class:"tree-stats"},re={class:"tree-nodes"};var ie={__name:"HierarchyTree",props:{hierarchy:Object},setup(a){async function n(e){await async function(e,a){if(t.busy)return;try{t.busy=!0,console.log(`[sendCommand] Sending ${e}:`,a);const n=await c({command:e,repo_url:t.repoUrl,ref:t.ref,data:a});console.log("[sendCommand] Response diff:",n.diff),console.log("[sendCommand] Pack state before merge:",a.pack_name?t.packs[a.pack_name]:"N/A"),E(t.packs,n.diff),t.stateHash=n.state_hash,t.warnings=n.warnings,console.log("[sendCommand] Pack state after merge:",a.pack_name?t.packs[a.pack_name]:"N/A")}catch(e){console.error("Command failed:",e)}finally{t.busy=!1}}("set_pack_action",{pack_name:e.pack_name,action:e.action})}function o(e){return mw.msg(e)}return(t,l)=>(e.openBlock(),e.createElementBlock("div",te,[e.createElementVNode("h3",null,e.toDisplayString(o("labkipackmanager-hierarchy-title")),1),a.hierarchy?(e.openBlock(),e.createElementBlock("div",oe,[e.createElementVNode("div",le,[e.createElementVNode("span",null,e.toDisplayString(o("labkipackmanager-pack-count"))+": "+e.toDisplayString(a.hierarchy.meta.pack_count),1),e.createElementVNode("span",null,e.toDisplayString(o("labkipackmanager-page-count"))+": "+e.toDisplayString(a.hierarchy.meta.page_count),1)]),e.createElementVNode("div",re,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.hierarchy.root_nodes,a=>(e.openBlock(),e.createBlock(ae,{key:a.id,node:a,depth:0,onSetPackAction:n},null,8,["node"]))),128))])])):(e.openBlock(),e.createElementBlock("div",ne,[e.createElementVNode("p",null,e.toDisplayString(o("labkipackmanager-no-hierarchy-loaded")),1)]))]))},__scopeId:"data-v-adb05fca",__file:"resources/src/ui/HierarchyTree.vue"};const ce={class:"details-panel"},se={class:"panel-content"},de={key:0,class:"warnings-section"},ue={key:1,class:"selected-packs-section"},pe={class:"packs-list"},me={class:"pack-header"},fe=["title"],ke={key:1,class:"pack-badge manual"},ge={class:"pack-details"},ve={key:0},ye={key:1},he={key:2},be={key:3},we={key:2,class:"no-selection"},_e={key:3,class:"state-info"},Ve={class:"action-buttons"};var Ne={__name:"DetailsPanel",setup(n){const o=e.ref(""),l=e.ref(""),r=e.computed(()=>{const e=[];for(const[a,n]of Object.entries(t.packs))n.action&&"unchanged"!==n.action&&e.push({name:a,state:n,pageCount:Object.keys(n.pages||{}).length});return e});async function i(){if(!t.busy)try{t.busy=!0,o.value="",l.value="";const e=await c({command:"apply",repo_url:t.repoUrl,ref:t.ref,data:{packs:t.packs,state_hash:t.stateHash}});E(t.packs,e.diff),t.stateHash=e.state_hash,t.warnings=e.warnings,e.operation?.operation_id?o.value=u("labkipackmanager-apply-success-with-id").replace("$1",e.operation.operation_id):o.value=u("labkipackmanager-apply-success")}catch(e){l.value=e instanceof Error?e.message:String(e)}finally{t.busy=!1}}async function s(){if(!t.busy)try{t.busy=!0,o.value="",l.value="";const e=await c({command:"refresh",repo_url:t.repoUrl,ref:t.ref,data:{}});E(t.packs,e.diff),t.stateHash=e.state_hash,t.warnings=e.warnings,o.value=u("labkipackmanager-refresh-success")}catch(e){l.value=e instanceof Error?e.message:String(e)}finally{t.busy=!1}}async function d(){if(!t.busy&&confirm(u("labkipackmanager-clear-confirm")))try{t.busy=!0,o.value="",l.value="",t.packs={},t.warnings=[];const e=await c({command:"clear",repo_url:t.repoUrl,ref:t.ref,data:{}});t.packs=e.diff,t.stateHash=e.state_hash,t.warnings=e.warnings,o.value=u("labkipackmanager-clear-success")}catch(e){l.value=e instanceof Error?e.message:String(e)}finally{t.busy=!1}}function u(e){return mw.msg(e)}return(n,c)=>(e.openBlock(),e.createElementBlock("div",ce,[e.createElementVNode("h3",null,e.toDisplayString(u("labkipackmanager-details-title")),1),e.createElementVNode("div",se,[e.createCommentVNode(" Warnings Section "),e.unref(t).warnings.length>0?(e.openBlock(),e.createElementBlock("div",de,[e.createElementVNode("h4",null,e.toDisplayString(u("labkipackmanager-warnings")),1),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(t).warnings,(t,n)=>(e.openBlock(),e.createBlock(e.unref(a.CdxMessage),{key:n,type:"warning",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(t),1)]),_:2},1024))),128))])):e.createCommentVNode("v-if",!0),e.createCommentVNode(" Selected Packs Section "),r.value.length>0?(e.openBlock(),e.createElementBlock("div",ue,[e.createElementVNode("h4",null,e.toDisplayString(u("labkipackmanager-selected-packs")),1),e.createElementVNode("div",pe,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(r.value,a=>(e.openBlock(),e.createElementBlock("div",{key:a.name,class:"pack-item"},[e.createElementVNode("div",me,[e.createElementVNode("strong",null,e.toDisplayString(a.name),1),a.state.auto_selected_reason?(e.openBlock(),e.createElementBlock("span",{key:0,class:"pack-badge auto",title:a.state.auto_selected_reason},e.toDisplayString(u("labkipackmanager-auto-selected")),9,fe)):(e.openBlock(),e.createElementBlock("span",ke,e.toDisplayString(u("labkipackmanager-manually-selected")),1))]),e.createElementVNode("div",ge,[a.state.action?(e.openBlock(),e.createElementBlock("div",ve,[e.createElementVNode("small",null,e.toDisplayString(u("labkipackmanager-action"))+": "+e.toDisplayString(a.state.action),1)])):e.createCommentVNode("v-if",!0),a.state.target_version?(e.openBlock(),e.createElementBlock("div",ye,[e.createElementVNode("small",null,e.toDisplayString(u("labkipackmanager-version"))+": "+e.toDisplayString(a.state.target_version),1)])):e.createCommentVNode("v-if",!0),a.state.prefix?(e.openBlock(),e.createElementBlock("div",he,[e.createElementVNode("small",null,e.toDisplayString(u("labkipackmanager-pack-prefix"))+": "+e.toDisplayString(a.state.prefix),1)])):e.createCommentVNode("v-if",!0),a.pageCount>0?(e.openBlock(),e.createElementBlock("div",be,[e.createElementVNode("small",null,e.toDisplayString(u("labkipackmanager-pages"))+": "+e.toDisplayString(a.pageCount),1)])):e.createCommentVNode("v-if",!0)])]))),128))])])):(e.openBlock(),e.createElementBlock("div",we,[e.createElementVNode("p",null,e.toDisplayString(u("labkipackmanager-no-packs-selected")),1)])),e.createCommentVNode(" State Hash (Debug) "),e.unref(t).stateHash?(e.openBlock(),e.createElementBlock("div",_e,[e.createElementVNode("small",null,[e.createTextVNode(e.toDisplayString(u("labkipackmanager-state-hash"))+": ",1),e.createElementVNode("code",null,e.toDisplayString(e.unref(t).stateHash),1)])])):e.createCommentVNode("v-if",!0),e.createCommentVNode(" Action Buttons "),e.createElementVNode("div",Ve,[e.createVNode(e.unref(a.CdxButton),{action:"progressive",weight:"primary",disabled:e.unref(t).busy||0===r.value.length,onClick:i},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(u("labkipackmanager-apply")),1)]),_:1},8,["disabled"]),e.createVNode(e.unref(a.CdxButton),{action:"default",disabled:e.unref(t).busy,onClick:s},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(u("labkipackmanager-refresh")),1)]),_:1},8,["disabled"]),e.createVNode(e.unref(a.CdxButton),{action:"destructive",weight:"quiet",disabled:e.unref(t).busy,onClick:d},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(u("labkipackmanager-clear")),1)]),_:1},8,["disabled"])]),e.createCommentVNode(" Operation Status "),o.value?(e.openBlock(),e.createBlock(e.unref(a.CdxMessage),{key:4,type:"success",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(o.value),1)]),_:1})):e.createCommentVNode("v-if",!0),l.value?(e.openBlock(),e.createBlock(e.unref(a.CdxMessage),{key:5,type:"error",inline:!0},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(l.value),1)]),_:1})):e.createCommentVNode("v-if",!0)])]))},__scopeId:"data-v-348c6e2c",__file:"resources/src/ui/DetailsPanel.vue"};const Ce={class:"labki-pack-manager-app"},Be={class:"app-header"},Se={class:"app-description"},Ee={key:0,class:"loading-overlay"},xe={class:"loading-spinner"},De={class:"app-main"};var Me={__name:"App",setup(a){function n(e){return mw.msg(e)}return e.onMounted(()=>{console.log("Labki Pack Manager initialized")}),(a,o)=>(e.openBlock(),e.createElementBlock("div",Ce,[e.createElementVNode("header",Be,[e.createElementVNode("h1",null,e.toDisplayString(n("labkipackmanager-special-title")),1),e.createElementVNode("p",Se,e.toDisplayString(n("labkipackmanager-special-description")),1)]),e.unref(t).busy?(e.openBlock(),e.createElementBlock("div",Ee,[e.createElementVNode("div",xe,e.toDisplayString(n("labkipackmanager-loading"))+"... ",1)])):e.createCommentVNode("v-if",!0),e.createElementVNode("main",De,[e.createVNode(_),e.unref(t).repoUrl&&e.unref(t).ref?(e.openBlock(),e.createBlock(S,{key:0,"mermaid-src":e.unref(t).mermaidSrc},null,8,["mermaid-src"])):e.createCommentVNode("v-if",!0),e.unref(t).repoUrl&&e.unref(t).ref?(e.openBlock(),e.createBlock(ie,{key:1,hierarchy:e.unref(t).hierarchy},null,8,["hierarchy"])):e.createCommentVNode("v-if",!0),e.unref(t).repoUrl&&e.unref(t).ref?(e.openBlock(),e.createBlock(Ne,{key:2})):e.createCommentVNode("v-if",!0)])]))}};Me.__scopeId="data-v-23151fc9",Me.__file="resources/src/ui/App.vue",console.log("Labki Pack Manager: main.ts loading..."),console.log("Labki Pack Manager: imports complete"),console.log("Labki Pack Manager: Checking MediaWiki environment..."),"undefined"!=typeof mw&&mw.loader?(console.log("Labki Pack Manager: MediaWiki environment available, starting bootstrap"),console.log("Labki Pack Manager: bootstrap called"),mw.loader.using(["vue","mediawiki.api","@wikimedia/codex","codex-styles"]).then(()=>{console.log("Labki Pack Manager: All modules loaded, initializing app"),function(){console.log("Labki Pack Manager: initApp called");const a=document.getElementById("labki-pack-manager-root");a?(console.log("Labki Pack Manager: Root element found, creating app"),e.createApp(Me).mount(a),console.log("Labki Pack Manager: Application mounted")):console.error("Labki Pack Manager: Root element not found")}()}).catch(e=>{console.error("Labki Pack Manager: Failed to load required modules",e)})):console.error("Labki Pack Manager: MediaWiki environment not available")}(Vue,Codex);
//# sourceMappingURL=app.bundle.js.map
